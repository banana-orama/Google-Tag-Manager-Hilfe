{
  "accountId": "572865630",
  "containerPath": "accounts/572865630/containers/208950707",
  "workspacePath": "accounts/572865630/containers/208950707/workspaces/19",
  "isServerContainer": true,
  "mode": "write_new",
  "delayMs": 800,
  "results": [
    {
      "name": "mcp_list_tools",
      "status": "pass",
      "details": {
        "count": 102
      }
    },
    {
      "name": "gtm_status",
      "status": "pass",
      "details": {
        "authenticated": true,
        "hasCredentials": true,
        "hasValidTokens": true,
        "rateLimits": {
          "dailyCount": 0,
          "dailyLimit": 10000,
          "queueLength": 0
        },
        "credentialsPath": "/Users/tobias_batke/.gtm-mcp/client_secrets.json"
      }
    },
    {
      "name": "gtm_list_accounts",
      "status": "pass",
      "details": [
        {
          "accountId": "572865630",
          "name": "Eigene Websites",
          "path": "accounts/572865630"
        },
        {
          "accountId": "6204082799",
          "name": "GAM Medical Germany",
          "path": "accounts/6204082799"
        },
        {
          "accountId": "4540457445",
          "name": "Wandtattoos.de",
          "path": "accounts/4540457445"
        },
        {
          "accountId": "6235742511",
          "name": "bkp GmbH",
          "path": "accounts/6235742511"
        },
        {
          "accountId": "6125952160",
          "name": "Universal Clean",
          "path": "accounts/6125952160"
        },
        {
          "accountId": "6073640915",
          "name": "Gam Medical",
          "path": "accounts/6073640915"
        },
        {
          "accountId": "3613365022",
          "name": "Michael Geyer Photography",
          "path": "accounts/3613365022"
        },
        {
          "accountId": "6244059618",
          "name": "Kinderstellar",
          "path": "accounts/6244059618"
        },
        {
          "accountId": "6083188446",
          "name": "BB Onlinemarketing Gbr",
          "path": "accounts/6083188446"
        },
        {
          "accountId": "4703172658",
          "name": "Bali Bracelets",
          "path": "accounts/4703172658"
        },
        {
          "accountId": "6236718037",
          "name": "Smart City System Parking Solutions GmbH",
          "path": "accounts/6236718037"
        },
        {
          "accountId": "6002441718",
          "name": "ROOQ GmbH",
          "path": "accounts/6002441718"
        },
        {
          "accountId": "6208943407",
          "name": "guterrat Gesundheitsprodukte",
          "path": "accounts/6208943407"
        },
        {
          "accountId": "2326724817",
          "name": "RADIO 21",
          "path": "accounts/2326724817"
        },
        {
          "accountId": "6315161703",
          "name": "GAM Medical ES",
          "path": "accounts/6315161703"
        },
        {
          "accountId": "1310374479",
          "name": "L-mobile solutions",
          "path": "accounts/1310374479"
        },
        {
          "accountId": "4701138060",
          "name": "Wandtattoo.de",
          "path": "accounts/4701138060"
        },
        {
          "accountId": "365208277",
          "name": "PHOS",
          "path": "accounts/365208277"
        },
        {
          "accountId": "6142113348",
          "name": "Medicross",
          "path": "accounts/6142113348"
        },
        {
          "accountId": "350250869",
          "name": "www.sonderpreis-baumarkt.de",
          "path": "accounts/350250869"
        },
        {
          "accountId": "2358111260",
          "name": "Adveniat e.V.",
          "path": "accounts/2358111260"
        },
        {
          "accountId": "6260641851",
          "name": "Futura Berlin GmbH",
          "path": "accounts/6260641851"
        },
        {
          "accountId": "6014006380",
          "name": "Myofficebrand",
          "path": "accounts/6014006380"
        },
        {
          "accountId": "6001971228",
          "name": "ETW",
          "path": "accounts/6001971228"
        },
        {
          "accountId": "6001883125",
          "name": "prethis.com",
          "path": "accounts/6001883125"
        },
        {
          "accountId": "566453661",
          "name": "Proveon",
          "path": "accounts/566453661"
        },
        {
          "accountId": "6221819844",
          "name": "Smarli",
          "path": "accounts/6221819844"
        },
        {
          "accountId": "6001235965",
          "name": "gesund24h.de",
          "path": "accounts/6001235965"
        },
        {
          "accountId": "6050884951",
          "name": "LeMerle",
          "path": "accounts/6050884951"
        },
        {
          "accountId": "6248215444",
          "name": "NEBU-TEC",
          "path": "accounts/6248215444"
        },
        {
          "accountId": "6000872213",
          "name": "Dog Fit Shop",
          "path": "accounts/6000872213"
        },
        {
          "accountId": "6319206708",
          "name": "Futura",
          "path": "accounts/6319206708"
        },
        {
          "accountId": "6003255881",
          "name": "Logistik XTRA GmbH",
          "path": "accounts/6003255881"
        },
        {
          "accountId": "6000123300",
          "name": "More in Common",
          "path": "accounts/6000123300"
        },
        {
          "accountId": "6225592186",
          "name": "Fotokistebodensee",
          "path": "accounts/6225592186"
        },
        {
          "accountId": "6326054341",
          "name": "Cozy Heaven",
          "path": "accounts/6326054341"
        },
        {
          "accountId": "6072541372",
          "name": "HollyDent",
          "path": "accounts/6072541372"
        },
        {
          "accountId": "4379821715",
          "name": "Quick-Lohn",
          "path": "accounts/4379821715"
        }
      ]
    },
    {
      "name": "gtm_get_account",
      "status": "pass",
      "details": {
        "path": "accounts/572865630",
        "accountId": "572865630",
        "name": "Eigene Websites",
        "fingerprint": "1532191856482",
        "tagManagerUrl": "https://tagmanager.google.com/#/admin/accounts/572865630?apiLink=account",
        "features": {
          "supportUserPermissions": true,
          "supportMultipleContainers": true
        }
      }
    },
    {
      "name": "gtm_list_containers",
      "status": "pass",
      "details": [
        {
          "containerId": "9499384",
          "name": "tobiasbatke.com",
          "publicId": "GTM-WKVBZG3",
          "path": "accounts/572865630/containers/9499384",
          "usageContext": [
            "web"
          ],
          "accountId": "572865630"
        },
        {
          "containerId": "208950707",
          "name": "Stape.io - tobiasbatke.com",
          "publicId": "GTM-KX4X75JJ",
          "path": "accounts/572865630/containers/208950707",
          "usageContext": [
            "server"
          ],
          "accountId": "572865630"
        },
        {
          "containerId": "243018951",
          "name": "Test Container WEB",
          "publicId": "GTM-KPGV9LDP",
          "path": "accounts/572865630/containers/243018951",
          "usageContext": [
            "web"
          ],
          "accountId": "572865630"
        },
        {
          "containerId": "243351242",
          "name": "MCP WEB Gallery Test 2026-02-11T10-47-45-965Z",
          "publicId": "GTM-NXQQGN2W",
          "path": "accounts/572865630/containers/243351242",
          "usageContext": [
            "web"
          ],
          "accountId": "572865630"
        }
      ]
    },
    {
      "name": "gtm_lookup_container",
      "status": "skip",
      "details": "Skipped: GTM_TEST_CONTAINER_PUBLIC_ID not set"
    },
    {
      "name": "gtm_get_container",
      "status": "pass",
      "details": {
        "containerId": "208950707",
        "name": "Stape.io - tobiasbatke.com",
        "publicId": "GTM-KX4X75JJ",
        "path": "accounts/572865630/containers/208950707",
        "usageContext": [
          "server"
        ],
        "accountId": "572865630",
        "tagManagerUrl": "https://tagmanager.google.com/#/container/accounts/572865630/containers/208950707/workspaces?apiLink=container",
        "features": {
          "supportUserPermissions": true,
          "supportEnvironments": true,
          "supportWorkspaces": true,
          "supportGtagConfigs": false,
          "supportBuiltInVariables": true,
          "supportClients": true,
          "supportFolders": true,
          "supportTags": true,
          "supportTemplates": true,
          "supportTriggers": true,
          "supportVariables": true,
          "supportVersions": true,
          "supportZones": true,
          "supportTransformations": true
        }
      }
    },
    {
      "name": "gate_create_container",
      "status": "pass",
      "details": {
        "error": "Confirmation required",
        "errorType": "CONFIRMATION_REQUIRED",
        "tool": "gtm_create_container",
        "action": "create_container",
        "help": "Re-run the tool call with {\"confirm\": true} to proceed."
      }
    },
    {
      "name": "gate_delete_container",
      "status": "pass",
      "details": {
        "error": "Confirmation required",
        "errorType": "CONFIRMATION_REQUIRED",
        "tool": "gtm_delete_container",
        "action": "delete_container",
        "help": "Re-run the tool call with {\"confirm\": true} to proceed."
      }
    },
    {
      "name": "gtm_list_workspaces",
      "status": "pass",
      "details": [
        {
          "workspaceId": "17",
          "name": "MCP Server 2026-02-11T10-31-12-001Z",
          "path": "accounts/572865630/containers/208950707/workspaces/17",
          "description": "target test"
        },
        {
          "workspaceId": "14",
          "name": "Default Workspace",
          "path": "accounts/572865630/containers/208950707/workspaces/14"
        }
      ]
    },
    {
      "name": "create_workspace",
      "status": "pass",
      "details": {
        "workspaceId": "19",
        "name": "MCP Selftest 2026-02-11T11-16-44-428Z",
        "path": "accounts/572865630/containers/208950707/workspaces/19",
        "description": "Created by MCP selftest"
      }
    },
    {
      "name": "gtm_get_workspace",
      "status": "pass",
      "details": {
        "workspaceId": "19",
        "name": "MCP Selftest 2026-02-11T11-16-44-428Z",
        "path": "accounts/572865630/containers/208950707/workspaces/19",
        "description": "Created by MCP selftest"
      }
    },
    {
      "name": "gtm_get_workspace_status",
      "status": "pass",
      "details": {
        "workspaceId": "19",
        "name": "",
        "hasChanges": false,
        "mergeConflicts": false,
        "changeCount": {
          "tags": 0,
          "triggers": 0,
          "variables": 0,
          "folders": 0
        }
      }
    },
    {
      "name": "gate_delete_workspace",
      "status": "pass",
      "details": {
        "error": "Confirmation required",
        "errorType": "CONFIRMATION_REQUIRED",
        "tool": "gtm_delete_workspace",
        "action": "delete_workspace",
        "help": "Re-run the tool call with {\"confirm\": true} to proceed."
      }
    },
    {
      "name": "gate_sync_workspace",
      "status": "pass",
      "details": {
        "error": "Confirmation required",
        "errorType": "CONFIRMATION_REQUIRED",
        "tool": "gtm_sync_workspace",
        "action": "sync_workspace",
        "note": "This pulls latest container changes into the workspace.",
        "help": "Re-run the tool call with {\"confirm\": true} to proceed."
      }
    },
    {
      "name": "mode",
      "status": "pass",
      "details": {
        "mode": "write_new",
        "writeAllowed": true
      }
    },
    {
      "name": "workspace_write_probe",
      "status": "pass",
      "details": {
        "workspacePath": "accounts/572865630/containers/208950707/workspaces/19"
      }
    },
    {
      "name": "gtm_list_tags",
      "status": "pass",
      "details": {
        "summary": {
          "total": 4,
          "byType": {
            "sgtmadscl": 1,
            "cvt_5TP8W": 1,
            "sgtmadsct": 1,
            "sgtmgaaw": 1
          },
          "paused": 0,
          "withoutTriggers": []
        },
        "tags": [
          {
            "tagId": "26",
            "name": "Conversion Linker",
            "type": "sgtmadscl",
            "path": "accounts/572865630/containers/208950707/workspaces/19/tags/26",
            "firingTriggerId": [
              "22"
            ]
          },
          {
            "tagId": "31",
            "name": "FB - PageView",
            "type": "cvt_5TP8W",
            "path": "accounts/572865630/containers/208950707/workspaces/19/tags/31",
            "firingTriggerId": [
              "22"
            ]
          },
          {
            "tagId": "37",
            "name": "GADS - Purchase Conversion",
            "type": "sgtmadsct",
            "path": "accounts/572865630/containers/208950707/workspaces/19/tags/37",
            "firingTriggerId": [
              "36"
            ]
          },
          {
            "tagId": "25",
            "name": "GA4 - All Events",
            "type": "sgtmgaaw",
            "path": "accounts/572865630/containers/208950707/workspaces/19/tags/25",
            "firingTriggerId": [
              "24"
            ]
          }
        ]
      }
    },
    {
      "name": "gtm_list_triggers",
      "status": "pass",
      "details": {
        "summary": {
          "total": 11,
          "byType": {
            "always": 3,
            "customEvent": 8
          }
        },
        "triggers": [
          {
            "triggerId": "58",
            "name": "MCP Selftest Always 2026-02-11T11-04-59-014Z Updated",
            "type": "always",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/58",
            "folderId": "56"
          },
          {
            "triggerId": "49",
            "name": "MCP Selftest Always 2026-02-11T10-17-03-682Z Updated",
            "type": "always",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/49",
            "folderId": "47"
          },
          {
            "triggerId": "43",
            "name": "MCP Selftest Always 2026-02-11T10-06-51-418Z Updated",
            "type": "always",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/43",
            "folderId": "41"
          },
          {
            "triggerId": "22",
            "name": "GA4 - page_view",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/22"
          },
          {
            "triggerId": "36",
            "name": "GA4 - purchase",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/36"
          },
          {
            "triggerId": "24",
            "name": "All Events",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/24"
          },
          {
            "triggerId": "14",
            "name": "click",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/14"
          },
          {
            "triggerId": "16",
            "name": "video",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/16"
          },
          {
            "triggerId": "12",
            "name": "scroll",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/12"
          },
          {
            "triggerId": "10",
            "name": "web_vitals",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/10"
          },
          {
            "triggerId": "9",
            "name": "Google Analytics Optout",
            "type": "customEvent",
            "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/9"
          }
        ]
      }
    },
    {
      "name": "gtm_list_variables",
      "status": "pass",
      "details": {
        "summary": {
          "total": 12,
          "byType": {
            "r": 3,
            "c": 5,
            "ed": 3,
            "sgtmk": 1
          }
        },
        "variables": [
          {
            "variableId": "57",
            "name": "MCP Selftest Random Updated 2026-02-11T11-04-59-014Z",
            "type": "r",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/57",
            "folderId": "56"
          },
          {
            "variableId": "48",
            "name": "MCP Selftest Random Updated 2026-02-11T10-17-03-682Z",
            "type": "r",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/48",
            "folderId": "47"
          },
          {
            "variableId": "42",
            "name": "MCP Selftest Random Updated 2026-02-11T10-06-51-418Z",
            "type": "r",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/42",
            "folderId": "41"
          },
          {
            "variableId": "28",
            "name": "FB - API Access Token",
            "type": "c",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/28"
          },
          {
            "variableId": "29",
            "name": "FB - Pixel ID",
            "type": "c",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/29"
          },
          {
            "variableId": "30",
            "name": "ed - event_id",
            "type": "ed",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/30"
          },
          {
            "variableId": "32",
            "name": "GADS - Conversion ID",
            "type": "c",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/32"
          },
          {
            "variableId": "33",
            "name": "GADS - Conversionlabel",
            "type": "c",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/33"
          },
          {
            "variableId": "34",
            "name": "ed - value",
            "type": "ed",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/34"
          },
          {
            "variableId": "35",
            "name": "ed - currency",
            "type": "ed",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/35"
          },
          {
            "variableId": "8",
            "name": "Cookie - borlabs-cookie",
            "type": "sgtmk",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/8"
          },
          {
            "variableId": "6",
            "name": "GA4 - Property ID",
            "type": "c",
            "path": "accounts/572865630/containers/208950707/workspaces/19/variables/6"
          }
        ]
      }
    },
    {
      "name": "gtm_list_folders",
      "status": "pass",
      "details": [
        {
          "folderId": "56",
          "name": "MCP Selftest Renamed 2026-02-11T11-04-59-014Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/56",
          "fingerprint": "1770807911110"
        },
        {
          "folderId": "47",
          "name": "MCP Selftest Renamed 2026-02-11T10-17-03-682Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/47",
          "fingerprint": "1770805035795"
        },
        {
          "folderId": "41",
          "name": "MCP Selftest Renamed 2026-02-11T10-06-51-418Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/41",
          "fingerprint": "1770804423480"
        }
      ]
    },
    {
      "name": "gtm_list_templates",
      "status": "pass",
      "details": {
        "total": 4,
        "templates": [
          {
            "templateId": "27",
            "name": "Facebook Conversion API",
            "path": "accounts/572865630/containers/208950707/workspaces/19/templates/27"
          },
          {
            "templateId": "20",
            "name": "GA4 Advanced",
            "path": "accounts/572865630/containers/208950707/workspaces/19/templates/20"
          },
          {
            "templateId": "18",
            "name": "PiwikPro",
            "path": "accounts/572865630/containers/208950707/workspaces/19/templates/18"
          },
          {
            "templateId": "4",
            "name": "Data Client",
            "path": "accounts/572865630/containers/208950707/workspaces/19/templates/4"
          }
        ]
      }
    },
    {
      "name": "gtm_get_container_info",
      "status": "pass",
      "details": {
        "accountId": "572865630",
        "containerId": "208950707",
        "name": "Stape.io - tobiasbatke.com",
        "publicId": "GTM-KX4X75JJ",
        "usageContext": [
          "server"
        ],
        "supportedFeatures": {
          "clients": true,
          "transformations": true,
          "zones": true,
          "triggers": [
            "always",
            "customEvent",
            "triggerGroup",
            "init",
            "consentInit",
            "serverPageview"
          ],
          "variables": [
            "c",
            "jsm",
            "v",
            "k",
            "aev",
            "r",
            "smm",
            "f",
            "ev",
            "fn",
            "d",
            "j",
            "ejs"
          ]
        },
        "capabilities": {
          "containerType": "server",
          "usageContext": [
            "server"
          ],
          "hasClients": true,
          "hasTransformations": true,
          "hasWebTriggers": false,
          "hasServerTriggers": true,
          "supportedTriggerTypes": [
            "always",
            "customEvent",
            "triggerGroup",
            "init",
            "consentInit",
            "serverPageview"
          ],
          "supportedVariableTypes": [
            "c",
            "jsm",
            "v",
            "k",
            "aev",
            "r",
            "smm",
            "f",
            "ev",
            "fn",
            "d",
            "j",
            "ejs"
          ],
          "notes": [
            "This is a Server container",
            "Clients and Transformations are available",
            "Only server trigger types are supported (always, customEvent, triggerGroup)"
          ]
        }
      }
    },
    {
      "name": "gtm_validate_trigger_config",
      "status": "pass",
      "details": {
        "valid": true,
        "errors": [],
        "warnings": [],
        "suggestions": [
          "Configuration looks good! You can create the trigger now."
        ],
        "example": {
          "validTemplate": {
            "type": "pageview",
            "name": "All Pages",
            "filter": [],
            "description": "Fires on all page views (no filter = all pages)",
            "containerType": "web"
          },
          "conditionFormat": {
            "correct": {
              "type": "contains",
              "parameter": [
                {
                  "key": "arg0",
                  "type": "template",
                  "value": "{{Page URL}}"
                },
                {
                  "key": "arg1",
                  "type": "template",
                  "value": "/checkout"
                }
              ]
            },
            "note": "Use arg0 and arg1 with parameter array (API v2 format)"
          }
        }
      }
    },
    {
      "name": "gtm_get_trigger_template",
      "status": "pass",
      "details": {
        "type": "customEvent",
        "name": "Custom Event",
        "customEventFilter": [
          {
            "type": "equals",
            "parameter": [
              {
                "key": "arg0",
                "type": "template",
                "value": "{{_event}}"
              },
              {
                "key": "arg1",
                "type": "template",
                "value": "my_event"
              }
            ]
          }
        ],
        "description": "Fires when dataLayer.push({ event: \"my_event\" }) is called. Change \"my_event\" to your event name.",
        "containerType": "both"
      }
    },
    {
      "name": "gtm_list_tag_types",
      "status": "pass",
      "details": [
        {
          "type": "html",
          "displayName": "Custom HTML",
          "category": "custom",
          "description": "Inject custom HTML or JavaScript code into pages"
        },
        {
          "type": "gaawe",
          "displayName": "GA4 Event",
          "category": "analytics",
          "description": "Send events to Google Analytics 4"
        },
        {
          "type": "googtag",
          "displayName": "Google tag (gtag.js)",
          "category": "analytics",
          "description": "Google tag configuration for GA4, Ads, etc."
        },
        {
          "type": "awct",
          "displayName": "Google Ads Conversion Tracking",
          "category": "advertising",
          "description": "Track Google Ads conversions"
        },
        {
          "type": "sp",
          "displayName": "Google Ads Remarketing",
          "category": "advertising",
          "description": "Google Ads remarketing tag"
        },
        {
          "type": "ua",
          "displayName": "Universal Analytics",
          "category": "analytics",
          "description": "Universal Analytics tracking (deprecated - use GA4 instead)"
        },
        {
          "type": "flc",
          "displayName": "Floodlight Counter",
          "category": "advertising",
          "description": "Google Marketing Platform Floodlight Counter tag"
        }
      ]
    },
    {
      "name": "gtm_get_tag_parameters",
      "status": "pass",
      "details": {
        "type": "html",
        "displayName": "Custom HTML",
        "category": "custom",
        "description": "Inject custom HTML or JavaScript code into pages",
        "containerCompatibility": [
          "web"
        ],
        "parameters": {
          "required": [
            {
              "key": "html",
              "type": "template",
              "required": true,
              "description": "HTML/JavaScript code to inject",
              "example": "<script>console.log(\"Hello\");</script>"
            }
          ],
          "optional": [
            {
              "key": "supportsDocumentWrite",
              "type": "boolean",
              "required": false,
              "description": "Allow document.write()",
              "example": "false",
              "defaultValue": "false"
            },
            {
              "key": "useIframe",
              "type": "boolean",
              "required": false,
              "description": "Render in iframe",
              "example": "false",
              "defaultValue": "false"
            }
          ]
        },
        "example": {
          "name": "Custom HTML Tag",
          "type": "html",
          "parameter": [
            {
              "key": "html",
              "type": "template",
              "value": "<script>console.log(\"test\");</script>"
            }
          ],
          "firingTriggerId": [
            "1"
          ]
        }
      }
    },
    {
      "name": "gtm_get_variable_parameters",
      "status": "pass",
      "details": {
        "type": "r",
        "parameters": {
          "required": [],
          "optional": [
            {
              "key": "min",
              "type": "integer",
              "required": false,
              "description": "Minimum value",
              "example": "0"
            },
            {
              "key": "max",
              "type": "integer",
              "required": false,
              "description": "Maximum value",
              "example": "100"
            }
          ]
        },
        "example": {
          "name": "Random Number",
          "type": "r",
          "parameter": []
        }
      }
    },
    {
      "name": "gtm_list_workflows",
      "status": "pass",
      "details": [
        {
          "id": "setup_ga4",
          "name": "GA4 Basic Setup",
          "description": "Set up Google Analytics 4 tracking with pageviews and basic events",
          "containerType": "web"
        },
        {
          "id": "setup_conversion_tracking",
          "name": "Google Ads Conversion Tracking",
          "description": "Set up conversion tracking for Google Ads campaigns",
          "containerType": "web"
        },
        {
          "id": "setup_form_tracking",
          "name": "Form Submission Tracking",
          "description": "Track form submissions with GA4 events",
          "containerType": "web"
        },
        {
          "id": "setup_scroll_tracking",
          "name": "Scroll Depth Tracking",
          "description": "Track how far users scroll on pages",
          "containerType": "web"
        },
        {
          "id": "setup_link_click_tracking",
          "name": "Link Click Tracking",
          "description": "Track clicks on internal and external links",
          "containerType": "web"
        },
        {
          "id": "setup_ecommerce_tracking",
          "name": "E-Commerce Tracking (GA4)",
          "description": "Complete e-commerce tracking with purchase events and product data",
          "containerType": "web"
        }
      ]
    },
    {
      "name": "gtm_get_workflow",
      "status": "pass",
      "details": {
        "id": "setup_ga4",
        "name": "GA4 Basic Setup",
        "description": "Set up Google Analytics 4 tracking with pageviews and basic events",
        "prerequisites": [
          "GA4 Property must exist in Google Analytics",
          "Measurement ID must be available (G-XXXXXXXXXX)",
          "Container must be a Web container"
        ],
        "estimatedTime": "10-15 minutes",
        "containerType": "web",
        "steps": [
          {
            "step": 1,
            "action": "Create Google tag (gtag.js)",
            "tool": "gtm_create_tag",
            "description": "Creates the Google tag configuration for GA4",
            "parameters": {
              "type": "googtag",
              "name": "Google tag - GA4",
              "parameter": [
                {
                  "key": "tagId",
                  "type": "template",
                  "value": "G-XXXXXXXXXX"
                }
              ]
            },
            "notes": [
              "Replace YOUR_MEASUREMENT_ID with your actual GA4 Measurement ID (e.g., G-XXXXXXXXXX)",
              "This tag should fire on all pages"
            ]
          },
          {
            "step": 2,
            "action": "Create All Pages Trigger",
            "tool": "gtm_create_trigger",
            "description": "Creates a trigger that fires on all page views",
            "parameters": {
              "type": "pageview",
              "name": "All Pages",
              "filter": []
            },
            "notes": [
              "No filter = fires on all pages",
              "This is the standard initialization trigger"
            ]
          },
          {
            "step": 3,
            "action": "Link Trigger to Tag",
            "tool": "gtm_create_tag",
            "description": "Update the tag with the trigger ID",
            "notes": [
              "Get the triggerId from step 2",
              "Add it to firingTriggerId array",
              "Save and test in preview mode"
            ]
          },
          {
            "step": 4,
            "action": "Test in Preview Mode",
            "tool": "gtm_get_workspace_status",
            "description": "Check workspace status and test the setup",
            "notes": [
              "Open GTM Preview mode",
              "Navigate to your website",
              "Verify GA4 tag fires on page load",
              "Check GA4 Real-Time reports"
            ]
          }
        ]
      }
    },
    {
      "name": "gtm_search_entities",
      "status": "pass",
      "details": [
        {
          "type": "trigger",
          "id": "58",
          "name": "MCP Selftest Always 2026-02-11T11-04-59-014Z Updated",
          "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/58",
          "additionalInfo": {
            "type": "always"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "trigger",
          "id": "49",
          "name": "MCP Selftest Always 2026-02-11T10-17-03-682Z Updated",
          "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/49",
          "additionalInfo": {
            "type": "always"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "trigger",
          "id": "43",
          "name": "MCP Selftest Always 2026-02-11T10-06-51-418Z Updated",
          "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/43",
          "additionalInfo": {
            "type": "always"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "variable",
          "id": "57",
          "name": "MCP Selftest Random Updated 2026-02-11T11-04-59-014Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/variables/57",
          "additionalInfo": {
            "type": "r"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "variable",
          "id": "48",
          "name": "MCP Selftest Random Updated 2026-02-11T10-17-03-682Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/variables/48",
          "additionalInfo": {
            "type": "r"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "variable",
          "id": "42",
          "name": "MCP Selftest Random Updated 2026-02-11T10-06-51-418Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/variables/42",
          "additionalInfo": {
            "type": "r"
          },
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "folder",
          "id": "56",
          "name": "MCP Selftest Renamed 2026-02-11T11-04-59-014Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/56",
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "folder",
          "id": "47",
          "name": "MCP Selftest Renamed 2026-02-11T10-17-03-682Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/47",
          "matchReason": "Name contains: \"mcp\""
        },
        {
          "type": "folder",
          "id": "41",
          "name": "MCP Selftest Renamed 2026-02-11T10-06-51-418Z",
          "path": "accounts/572865630/containers/208950707/workspaces/19/folders/41",
          "matchReason": "Name contains: \"mcp\""
        }
      ]
    },
    {
      "name": "gtm_check_best_practices",
      "status": "pass",
      "details": {
        "score": 98,
        "issues": [
          {
            "severity": "info",
            "type": "missing_analytics",
            "message": "No analytics configuration found",
            "recommendation": "Consider adding GA4 tracking for analytics insights"
          }
        ],
        "recommendations": [
          "Add GA4 configuration tag for analytics tracking",
          "Add analytics tracking for better insights"
        ],
        "summary": {
          "totalIssues": 1,
          "errors": 0,
          "warnings": 0,
          "info": 1
        },
        "stats": {
          "tags": {
            "total": 4,
            "paused": 0,
            "withoutTriggers": 0
          },
          "triggers": {
            "total": 11
          },
          "variables": {
            "total": 12
          },
          "folders": {
            "total": 3
          }
        }
      }
    },
    {
      "name": "gtm_analyze_container",
      "status": "pass",
      "details": {
        "container": "Stape.io - tobiasbatke.com",
        "publicId": "GTM-KX4X75JJ",
        "usageContext": [
          "server"
        ],
        "tags": {
          "total": 4,
          "byType": {
            "sgtmgaaw": 1,
            "sgtmadscl": 1,
            "cvt_5TP8W": 1,
            "sgtmadsct": 1
          },
          "paused": 0,
          "withoutTriggers": []
        },
        "triggers": {
          "total": 8,
          "byType": {
            "customEvent": 8
          }
        },
        "variables": {
          "total": 9,
          "byType": {
            "c": 5,
            "sgtmk": 1,
            "ed": 3
          }
        },
        "folders": 0,
        "clients": 1
      }
    },
    {
      "name": "gtm_list_built_in_variables",
      "status": "pass",
      "details": [
        {
          "name": "Client Name",
          "type": "clientName",
          "path": "accounts/572865630/containers/208950707/workspaces/19/built_in_variables"
        },
        {
          "name": "Event Name",
          "type": "eventName",
          "path": "accounts/572865630/containers/208950707/workspaces/19/built_in_variables"
        }
      ]
    },
    {
      "name": "gtm_create_folder",
      "status": "pass",
      "details": {
        "folderId": "62",
        "name": "MCP Selftest 2026-02-11T11-18-11-050Z",
        "path": "accounts/572865630/containers/208950707/workspaces/19/folders/62",
        "fingerprint": "1770808695621"
      }
    },
    {
      "name": "gtm_get_folder",
      "status": "pass",
      "details": {
        "folderId": "62",
        "name": "MCP Selftest 2026-02-11T11-18-11-050Z",
        "path": "accounts/572865630/containers/208950707/workspaces/19/folders/62",
        "fingerprint": "1770808695621"
      }
    },
    {
      "name": "gtm_update_folder",
      "status": "pass",
      "details": {
        "folderId": "62",
        "name": "MCP Selftest Renamed 2026-02-11T11-18-11-050Z",
        "path": "accounts/572865630/containers/208950707/workspaces/19/folders/62",
        "fingerprint": "1770808703547"
      }
    },
    {
      "name": "gtm_get_folder_entities",
      "status": "pass",
      "details": {
        "folderId": "62",
        "tags": [],
        "triggers": [],
        "variables": []
      }
    },
    {
      "name": "gtm_create_variable",
      "status": "pass",
      "details": {
        "variableId": "63",
        "name": "MCP Selftest Random 2026-02-11T11-18-11-050Z",
        "type": "r",
        "path": "accounts/572865630/containers/208950707/workspaces/19/variables/63",
        "fingerprint": "1770808711635"
      }
    },
    {
      "name": "gtm_get_variable",
      "status": "pass",
      "details": {
        "variableId": "63",
        "name": "MCP Selftest Random 2026-02-11T11-18-11-050Z",
        "type": "r",
        "path": "accounts/572865630/containers/208950707/workspaces/19/variables/63",
        "fingerprint": "1770808711635"
      }
    },
    {
      "name": "gtm_update_variable",
      "status": "pass",
      "details": {
        "variableId": "63",
        "name": "MCP Selftest Random Updated 2026-02-11T11-18-11-050Z",
        "type": "r",
        "path": "accounts/572865630/containers/208950707/workspaces/19/variables/63",
        "fingerprint": "1770808727831"
      }
    },
    {
      "name": "gtm_create_trigger",
      "status": "pass",
      "details": {
        "triggerId": "64",
        "name": "MCP Selftest Always 2026-02-11T11-18-11-050Z",
        "type": "always",
        "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/64",
        "fingerprint": "1770808731163"
      }
    },
    {
      "name": "gtm_get_trigger",
      "status": "pass",
      "details": {
        "triggerId": "64",
        "name": "MCP Selftest Always 2026-02-11T11-18-11-050Z",
        "type": "always",
        "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/64",
        "fingerprint": "1770808731163"
      }
    },
    {
      "name": "gtm_update_trigger",
      "status": "pass",
      "details": {
        "triggerId": "64",
        "name": "MCP Selftest Always 2026-02-11T11-18-11-050Z Updated",
        "type": "always",
        "path": "accounts/572865630/containers/208950707/workspaces/19/triggers/64",
        "fingerprint": "1770808747643"
      }
    },
    {
      "name": "gtm_create_tag",
      "status": "skip",
      "details": "Skipped: server container"
    },
    {
      "name": "gtm_get_tag",
      "status": "skip",
      "details": "Skipped: tag not created"
    },
    {
      "name": "gtm_update_tag",
      "status": "skip",
      "details": "Skipped: tag not created"
    },
    {
      "name": "gtm_revert_tag",
      "status": "skip",
      "details": "Skipped: tag not created"
    },
    {
      "name": "gtm_move_entities_to_folder",
      "status": "pass",
      "details": {
        "moved": true
      }
    },
    {
      "name": "gtm_create_zone",
      "status": "skip",
      "details": "Skipped: zone tests are not applicable for server container workflow"
    },
    {
      "name": "gtm_get_zone",
      "status": "skip",
      "details": "Skipped: zone not created (server container)"
    },
    {
      "name": "gtm_update_zone",
      "status": "skip",
      "details": "Skipped: zone not created (server container)"
    },
    {
      "name": "gtm_list_environments",
      "status": "pass",
      "details": [
        {
          "environmentId": "1",
          "name": "Live",
          "type": "live",
          "path": "accounts/572865630/containers/208950707/environments/1",
          "authorizationCode": "xnIcKbI030EhO7n9_pIxCw"
        },
        {
          "environmentId": "2",
          "name": "Latest",
          "type": "latest",
          "path": "accounts/572865630/containers/208950707/environments/2",
          "authorizationCode": "ZbxfvN3Lm1UH2O2oO55jpQ"
        },
        {
          "environmentId": "3",
          "name": "Preview Environment 2 2025-03-18 072405",
          "type": "workspace",
          "path": "accounts/572865630/containers/208950707/environments/3",
          "authorizationCode": "EEXRzdvk5QTHyaTQkws_ow"
        }
      ]
    },
    {
      "name": "gtm_create_environment",
      "status": "pass",
      "details": {
        "environmentId": "65",
        "name": "MCP Selftest Env 2026-02-11T11-18-11-050Z",
        "type": "",
        "path": "accounts/572865630/containers/208950707/environments/65",
        "authorizationCode": "TOEfmyMhtM2Y5GpMLc2aCw",
        "description": "Created by MCP selftest",
        "fingerprint": "1770808759478",
        "enableDebug": true
      }
    },
    {
      "name": "gtm_get_environment",
      "status": "pass",
      "details": {
        "environmentId": "65",
        "name": "MCP Selftest Env 2026-02-11T11-18-11-050Z",
        "type": "",
        "path": "accounts/572865630/containers/208950707/environments/65",
        "authorizationCode": "TOEfmyMhtM2Y5GpMLc2aCw",
        "description": "Created by MCP selftest",
        "fingerprint": "1770808759478",
        "authorizationTimestamp": "2026-02-11T11:19:19.477Z",
        "containerId": "208950707",
        "enableDebug": true
      }
    },
    {
      "name": "gtm_update_environment",
      "status": "pass",
      "details": null
    },
    {
      "name": "gtm_reauthorize_environment",
      "status": "pass",
      "details": {
        "environmentId": "65",
        "name": "MCP Selftest Env 2026-02-11T11-18-11-050Z",
        "type": "",
        "path": "accounts/572865630/containers/208950707/environments/65",
        "authorizationCode": "OPb01bCORzevl7KyjsQluA",
        "authorizationTimestamp": "2026-02-11T11:19:30.977Z"
      }
    },
    {
      "name": "gtm_list_destinations",
      "status": "pass",
      "details": []
    },
    {
      "name": "gtm_get_destination",
      "status": "skip",
      "details": "Skipped: no destinations found"
    },
    {
      "name": "gtm_link_destination",
      "status": "skip",
      "details": "Skipped: set GTM_SELFTEST_DESTINATION_ID to enable"
    },
    {
      "name": "gtm_list_gtag_configs",
      "status": "pass",
      "details": []
    },
    {
      "name": "gtm_create_gtag_config",
      "status": "pass",
      "details": null
    },
    {
      "name": "gtm_get_gtag_config",
      "status": "pass",
      "details": null
    },
    {
      "name": "gtm_update_gtag_config",
      "status": "pass",
      "details": null
    },
    {
      "name": "gtm_import_template_from_gallery",
      "status": "pass",
      "details": {
        "templateId": "66",
        "name": "LinkedIn Conversion API",
        "path": "accounts/572865630/containers/208950707/workspaces/19/templates/66",
        "fingerprint": "1770808796176",
        "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"TAG\",\n  \"id\": \"cvt_PBNHC\",\n  \"version\": 1,\n  \"displayName\": \"LinkedIn Conversion API\",\n  \"brand\": {\n    \"id\": \"github.com_stape-io\",\n    \"displayName\": \"stape-io\",\n    \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\"\n  },\n  \"description\": \"Tag that sends the event data from the GA4/Data client to LinkedIn Conversion API.\",\n  \"containerContexts\": [\n    \"SERVER\"\n  ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"type\",\n    \"displayName\": \"Event Type\",\n    \"radioItems\": [\n      {\n        \"value\": \"page_view\",\n        \"displayValue\": \"Page View\"\n      },\n      {\n        \"value\": \"conversion\",\n        \"displayValue\": \"Conversion\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"help\": \"\\u003cb\\u003ePage View\\u003c/b\\u003e - stores the li_fat_id URL parameter inside the li_fat_id cookie\\u003cbr\\u003e\\u003cbr\\u003e \\u003cb\\u003eConversion\\u003c/b\\u003e - Send request with data about the conversion to the LinkedIn\",\n    \"defaultValue\": \"conversion\"\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"accessToken\",\n    \"displayName\": \"Access Token\",\n    \"simpleValueType\": true,\n    \"help\": \"LinkedIn API access token \\u003ca href\\u003d\\\"https://www.linkedin.com/help/lms/answer/a1718034\\\"\\u003eLearn more\\u003c/a\\u003e\",\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"conversionRuleUrn\",\n    \"displayName\": \"Conversion Rule ID\",\n    \"simpleValueType\": true,\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Event Data Override\",\n    \"name\": \"eventDataGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"eventData\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"conversionHappenedAt\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"conversionHappenedAt\",\n                \"displayValue\": \"Conversion Happened At\"\n              },\n              {\n                \"value\": \"currency\",\n                \"displayValue\": \"Currency\"\n              },\n              {\n                \"value\": \"amount\",\n                \"displayValue\": \"Amount\"\n              },\n              {\n                \"value\": \"eventId\",\n                \"displayValue\": \"Event ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\",\n        \"valueValidators\": []\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Ids Override\",\n    \"name\": \"userIdsGroup\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"LABEL\",\n        \"name\": \"userIdsLabel\",\n        \"displayName\": \"Tag will attempt to parse cookie/event data but you can provide those parameter explicitly, at least one identifier is needed for a successful request.\"\n      },\n      {\n        \"name\": \"userIds\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"email\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"email\",\n                \"displayValue\": \"SHA256_EMAIL\"\n              },\n              {\n                \"value\": \"linkedinFirstPartyId\",\n                \"displayValue\": \"LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID\"\n              },\n              {\n                \"value\": \"acxiomID\",\n                \"displayValue\": \"ACXIOM ID\"\n              },\n              {\n                \"value\": \"moatID\",\n                \"displayValue\": \"ORACLE_MOAT_ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Info Override\",\n    \"name\": \"userInfoGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"userInfo\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"firstName\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"firstName\",\n                \"displayValue\": \"First Name\"\n              },\n              {\n                \"value\": \"lastName\",\n                \"displayValue\": \"Last Name\"\n              },\n              {\n                \"value\": \"jobTitle\",\n                \"displayValue\": \"Job Title\"\n              },\n              {\n                \"value\": \"companyName\",\n                \"displayValue\": \"Company Name\"\n              },\n              {\n                \"value\": \"countryCode\",\n                \"displayValue\": \"Country Code\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"consentSettingsGroup\",\n    \"displayName\": \"Consent Settings\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"adStorageConsent\",\n        \"displayName\": \"\",\n        \"radioItems\": [\n          {\n            \"value\": \"optional\",\n            \"displayValue\": \"Send data always\"\n          },\n          {\n            \"value\": \"required\",\n            \"displayValue\": \"Send data in case marketing consent given\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"optional\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Logs Settings\",\n    \"name\": \"logsGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"logType\",\n        \"radioItems\": [\n          {\n            \"value\": \"no\",\n            \"displayValue\": \"Do not log\"\n          },\n          {\n            \"value\": \"debug\",\n            \"displayValue\": \"Log to console during debug and preview\"\n          },\n          {\n            \"value\": \"always\",\n            \"displayValue\": \"Always log to console\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"debug\"\n      }\n    ]\n  }\n]\n\n\n___SANDBOXED_JS_FOR_SERVER___\n\nconst getAllEventData = require('getAllEventData');\nconst JSON = require('JSON');\nconst sendHttpRequest = require('sendHttpRequest');\nconst getContainerVersion = require('getContainerVersion');\nconst logToConsole = require('logToConsole');\nconst sha256Sync = require('sha256Sync');\nconst getRequestHeader = require('getRequestHeader');\nconst getType = require('getType');\nconst makeString = require('makeString');\nconst encodeUriComponent = require('encodeUriComponent');\nconst getTimestampMillis = require('getTimestampMillis');\nconst Math = require('Math');\nconst makeNumber = require('makeNumber');\nconst makeTableMap = require('makeTableMap');\nconst getCookieValues = require('getCookieValues');\nconst decodeUriComponent = require('decodeUriComponent');\nconst parseUrl = require('parseUrl');\nconst setCookie = require('setCookie');\n\nconst isLoggingEnabled = determinateIsLoggingEnabled();\nconst traceId = isLoggingEnabled ? getRequestHeader('trace-id') : undefined;\nconst cookieName = 'li_fat_id';\n\nconst eventData = getAllEventData();\n\nif (!isConsentGivenOrNotRequired()) {\n  return data.gtmOnSuccess();\n}\n\nif (data.type === 'page_view') {\n  const url = eventData.page_location || getRequestHeader('referer');\n\n  if (url) {\n    const value = parseUrl(url).searchParams[cookieName];\n\n    if (value) {\n      const options = {\n        domain: 'auto',\n        path: '/',\n        secure: true,\n        httpOnly: false,\n        'max-age': 86400 * 90\n      };\n\n      setCookie(cookieName, value, options, false);\n    }\n  }\n\n  return data.gtmOnSuccess();\n}\n\nconst user_data = eventData.user_data || {};\n\nlet user_address = user_data.address;\nif (['array', 'object'].indexOf(getType(user_address)) === -1) {\n  user_address = {};\n}\nuser_address = user_address[0] || user_address || {};\n\nconst eventDataOverride = makeOverrideTableMap(data.eventData);\nconst userIdsOverride = makeOverrideTableMap(data.userIds);\nconst userInfoOverride = makeOverrideTableMap(data.userInfo);\n\nconst postUrl = getRequestUrl();\nconst postBody = getPostBody();\nconst postHeaders = getRequestHeaders();\n\nif (isLoggingEnabled) {\n  logToConsole(\n    JSON.stringify({\n      Name: 'LinkedIn',\n      Type: 'Request',\n      TraceId: traceId,\n      EventName: postBody.eventId,\n      RequestMethod: 'POST',\n      RequestUrl: postUrl,\n      RequestBody: postBody\n    })\n  );\n}\n\n// perform validation check on presence of 1/4 of the required IDs. If at least 1 ID is present, make the API call. If no IDs are present, log the warning and no call is made\nif (validateUserData()) {\n  sendConversionToLinkedIn();\n} else {\n  if (isLoggingEnabled) {\n    logToConsole(\n      JSON.stringify({\n        Name: 'LinkedIn',\n        Type: 'Message',\n        TraceId: traceId,\n        EventName: postBody.eventId,\n        Message: 'No conversion event was sent to LinkedIn CAPI.',\n        Reason:\n          'You must set 1 out of the 4 acceptable IDs (SHA256_EMAIL, LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID, ACXIOM_ID, ORACLE_MOAT_ID) to resolve this issue or make certain to send both firstName and lastName.'\n      })\n    );\n  }\n\n  data.gtmOnFailure();\n}\n\nfunction validateUserData() {\n  if (postBody.user.userIds.length > 0) {\n    return true;\n  }\n\n  return postBody.user.userInfo.firstName && postBody.user.userInfo.lastName;\n}\n\nfunction sendConversionToLinkedIn() {\n  sendHttpRequest(\n    postUrl,\n    (statusCode, headers, body) => {\n      if (isLoggingEnabled) {\n        logToConsole(\n          JSON.stringify({\n            Name: 'LinkedIn',\n            Type: 'Response',\n            TraceId: traceId,\n            EventName: postBody.eventId,\n            ResponseStatusCode: statusCode,\n            ResponseHeaders: headers,\n            ResponseBody: body\n          })\n        );\n      }\n\n      if (statusCode >= 200 && statusCode < 300) {\n        data.gtmOnSuccess();\n      } else {\n        data.gtmOnFailure();\n      }\n    },\n    {\n      headers: postHeaders,\n      method: 'POST'\n    },\n    JSON.stringify(postBody)\n  );\n}\n\nfunction getRequestUrl() {\n  return 'https://api.linkedin.com/rest/conversionEvents';\n}\n\nfunction getRequestHeaders() {\n  return {\n    'Content-Type': 'application/json',\n    Authorization: 'Bearer ' + data.accessToken,\n    'LinkedIn-Version': '202506',\n    'X-Restli-Protocol-Version': '2.0.0'\n  };\n}\n\nfunction getPostBody() {\n  const result = {\n    conversion: getConversionRuleUrn(),\n    conversionHappenedAt: getConversionHappenedAt(),\n    eventId: getEventId(),\n    user: {\n      userIds: getUserIds(),\n      userInfo: getUserInfo()\n    }\n  };\n  const conversionValue = getConversionValue();\n  if (conversionValue) result.conversionValue = conversionValue;\n  return result;\n}\n\nfunction getConversionRuleUrn() {\n  return 'urn:lla:llaPartnerConversion:' + data.conversionRuleUrn;\n}\n\nfunction getConversionHappenedAt() {\n  if (eventDataOverride.conversionHappenedAt)\n    return makeNumber(eventDataOverride.conversionHappenedAt);\n  if (eventData.conversion_happened_at)\n    return makeNumber(eventData.conversion_happened_at);\n  if (eventData.event_time) return makeNumber(eventData.event_time);\n  return Math.round(getTimestampMillis());\n}\n\nfunction getConversionValue() {\n  const hasItems = getType(eventData.items) === 'array' && !!eventData.items[0];\n  const itemsCurrency = hasItems ? eventData.items[0].currency : '';\n  const currencyCode =\n    eventDataOverride.currency || eventData.currency || itemsCurrency;\n  if (!currencyCode) return null;\n  const itemsValue = hasItems\n    ? eventData.items.reduce((acc, item) => {\n        const price = item.price || 0;\n        const quantity = item.quantity || 1;\n        return acc + price * quantity;\n      }, 0)\n    : 0;\n  const amount = eventDataOverride.amount || eventData.value || itemsValue;\n  return {\n    currencyCode: currencyCode,\n    amount: makeString(amount)\n  };\n}\n\nfunction getEventId() {\n  return (\n    eventDataOverride.eventId || eventData.eventId || eventData.event_id || ''\n  );\n}\n\nfunction getUserIds() {\n  const userIds = [\n    {\n      idType: 'SHA256_EMAIL',\n      idValue: hashData(getUserEmail())\n    },\n    {\n      idType: 'LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID',\n      idValue: getLinkedInFirstPartyAdsTrackingUuid()\n    },\n    {\n      idType: 'ACXIOM_ID',\n      idValue: getAcxiomId()\n    },\n    {\n      idType: 'ORACLE_MOAT_ID',\n      idValue: getOracleMoatId()\n    }\n  ];\n\n  return userIds.filter((userId) => userId.idValue);\n}\n\nfunction getUserIdFactory(idType, getIdValue) {\n  return {\n    idType: idType,\n    idValue: getIdValue\n  };\n}\n\nfunction getUserEmail() {\n  return (\n    userIdsOverride.email ||\n    eventData.email ||\n    user_data.email_address ||\n    user_data.email ||\n    ''\n  );\n}\n\nfunction getLinkedInFirstPartyAdsTrackingUuid() {\n  const liFatId = decodeUriComponent(getCookieValues(cookieName)[0] || '');\n  return (\n    liFatId ||\n    userIdsOverride.linkedinFirstPartyId ||\n    user_data.linkedinFirstPartyId ||\n    ''\n  );\n}\n\nfunction getAcxiomId() {\n  return userIdsOverride.acxiomID || user_data.acxiomID || '';\n}\n\nfunction getOracleMoatId() {\n  return userIdsOverride.moatID || user_data.moatID || '';\n}\n\nfunction getUserFirstName() {\n  return (\n    userInfoOverride.firstName ||\n    eventData.firstName ||\n    eventData.FirstName ||\n    eventData.nameFirst ||\n    eventData.first_name ||\n    user_data.first_name ||\n    user_address.first_name ||\n    ''\n  );\n}\n\nfunction getUserLastName() {\n  return (\n    userInfoOverride.lastName ||\n    eventData.lastName ||\n    eventData.LastName ||\n    eventData.nameLast ||\n    eventData.last_name ||\n    user_data.last_name ||\n    user_address.last_name ||\n    ''\n  );\n}\n\nfunction getUserJobTitle() {\n  return (\n    userInfoOverride.jobTitle ||\n    eventData.jobTitle ||\n    user_data.jobTitle ||\n    user_data.job_title ||\n    ''\n  );\n}\n\nfunction getUserCompanyName() {\n  return (\n    userInfoOverride.companyName ||\n    eventData.companyName ||\n    eventData.company_name ||\n    user_data.companyName ||\n    user_data.company_name ||\n    ''\n  );\n}\n\nfunction getUserCountryCode() {\n  return (\n    userInfoOverride.countryCode ||\n    eventData.countryCode ||\n    eventData.country ||\n    user_data.country ||\n    user_address.country ||\n    ''\n  );\n}\n\nfunction getUserInfo() {\n  return {\n    firstName: getUserFirstName(),\n    lastName: getUserLastName(),\n    title: getUserJobTitle(),\n    companyName: getUserCompanyName(),\n    countryCode: getUserCountryCode()\n  };\n}\n\nfunction isHashed(value) {\n  if (!value) {\n    return false;\n  }\n\n  return makeString(value).match('^[A-Fa-f0-9]{64}$') !== null;\n}\n\nfunction hashData(value) {\n  if (!value) {\n    return value;\n  }\n\n  const type = getType(value);\n\n  if (type === 'undefined' || value === 'undefined') {\n    return undefined;\n  }\n\n  if (type === 'object' || type === 'array') {\n    return value;\n  }\n\n  if (isHashed(value)) {\n    return value;\n  }\n\n  value = makeString(value).trim().toLowerCase();\n\n  return sha256Sync(value, { outputEncoding: 'hex' });\n}\n\nfunction enc(data) {\n  return encodeUriComponent(data || '');\n}\n\nfunction makeOverrideTableMap(values) {\n  return makeTableMap(values || [], 'name', 'value') || {};\n}\n\nfunction determinateIsLoggingEnabled() {\n  const containerVersion = getContainerVersion();\n  const isDebug = !!(\n    containerVersion &&\n    (containerVersion.debugMode || containerVersion.previewMode)\n  );\n\n  if (!data.logType) {\n    return isDebug;\n  }\n\n  if (data.logType === 'no') {\n    return false;\n  }\n\n  if (data.logType === 'debug') {\n    return isDebug;\n  }\n\n  return data.logType === 'always';\n}\n\nfunction isConsentGivenOrNotRequired() {\n  if (data.adStorageConsent !== 'required') return true;\n  if (eventData.consent_state) return !!eventData.consent_state.ad_storage;\n  const xGaGcs = eventData['x-ga-gcs'] || ''; // x-ga-gcs is a string like \"G110\"\n  return xGaGcs[2] === '1';\n}\n\n\n___SERVER_PERMISSIONS___\n\n[\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_request\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"headerWhitelist\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"trace-id\"\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"referer\"\n                  }\n                ]\n              }\n            ]\n          }\n        },\n        {\n          \"key\": \"headersAllowed\",\n          \"value\": {\n            \"type\": 8,\n            \"boolean\": true\n          }\n        },\n        {\n          \"key\": \"requestAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"headerAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"queryParameterAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"logging\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"environments\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"all\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_container_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_event_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"eventDataAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"send_http\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedUrls\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"urls\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"https://api.linkedin.com/rest/conversionEvents\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"cookieAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"cookieNames\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"li_fat_id\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"set_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedCookies\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"name\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"domain\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"path\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"secure\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"session\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"li_fat_id\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: User data address is object and properties are at the root level\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      country:\\\n    \\ \\\"Brazil\\\",\\n      first_name: \\\"Test First Name\\\",\\n      last_name: \\\"Test\\\n    \\ Last Name\\\",\\n      qweqwewa: 123123\\n    }   \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address.first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address.last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address.country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is object with properties in a nested object in the '0'\n    key\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      0:\\\n    \\ {\\n        country: \\\"Brazil\\\",\\n        first_name: \\\"Test First Name\\\",\\n\\\n    \\        last_name: \\\"Test Last Name\\\"\\n      }\\n    }  \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is array with properties in an object at the first position\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: [{\\n      first_name:\\\n    \\ \\\"Test First Name\\\",\\n      last_name: \\\"Test Last Name\\\",\\n      country: \\\"\\\n    Brazil\\\",\\n      postal_code: \\\"example.com\\\"\\n    }]\\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is empty object\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com',\\n\\\n    \\    address: {}\\n  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\n\\\n    mock('sendHttpRequest', function(url, callback, headers, body) {\\n  const parsedBody\\\n    \\ = JSON.parse(body);\\n  if (parsedBody && parsedBody.user && parsedBody.user.userInfo)\\\n    \\ {\\n    if (\\n      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is not supplied\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com'\\n\\\n    \\  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\nmock('sendHttpRequest',\\\n    \\ function(url, callback, headers, body) {\\n  const parsedBody = JSON.parse(body);\\n\\\n    \\  if (parsedBody && parsedBody.user && parsedBody.user.userInfo) {\\n    if (\\n\\\n    \\      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\nsetup: |-\n  const JSON = require('JSON');\n\n  const mockData = {\n    \"type\": \"conversion\",\n    \"accessToken\": \"token\",\n    \"conversionRuleUrn\": \"123123\"\n  };\n\n\n___NOTES___\n\nCreated on 18/08/2022, 12:25:26\n\n\n",
        "galleryReference": {
          "host": "github.com",
          "owner": "stape-io",
          "repository": "linkedin-tag",
          "version": "94000fb78f50b2442788a620ae34628cfbf16910",
          "signature": "fd3b56138ac116517f44b843f38b7f1ed24ea520e722b7c87414dc1aa8c35982"
        }
      }
    },
    {
      "name": "gtm_get_template",
      "status": "pass",
      "details": {
        "templateId": "66",
        "name": "LinkedIn Conversion API",
        "path": "accounts/572865630/containers/208950707/workspaces/19/templates/66",
        "fingerprint": "1770808796176",
        "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"TAG\",\n  \"id\": \"cvt_PBNHC\",\n  \"version\": 1,\n  \"displayName\": \"LinkedIn Conversion API\",\n  \"brand\": {\n    \"id\": \"github.com_stape-io\",\n    \"displayName\": \"stape-io\",\n    \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\"\n  },\n  \"description\": \"Tag that sends the event data from the GA4/Data client to LinkedIn Conversion API.\",\n  \"containerContexts\": [\n    \"SERVER\"\n  ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"type\",\n    \"displayName\": \"Event Type\",\n    \"radioItems\": [\n      {\n        \"value\": \"page_view\",\n        \"displayValue\": \"Page View\"\n      },\n      {\n        \"value\": \"conversion\",\n        \"displayValue\": \"Conversion\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"help\": \"\\u003cb\\u003ePage View\\u003c/b\\u003e - stores the li_fat_id URL parameter inside the li_fat_id cookie\\u003cbr\\u003e\\u003cbr\\u003e \\u003cb\\u003eConversion\\u003c/b\\u003e - Send request with data about the conversion to the LinkedIn\",\n    \"defaultValue\": \"conversion\"\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"accessToken\",\n    \"displayName\": \"Access Token\",\n    \"simpleValueType\": true,\n    \"help\": \"LinkedIn API access token \\u003ca href\\u003d\\\"https://www.linkedin.com/help/lms/answer/a1718034\\\"\\u003eLearn more\\u003c/a\\u003e\",\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"conversionRuleUrn\",\n    \"displayName\": \"Conversion Rule ID\",\n    \"simpleValueType\": true,\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Event Data Override\",\n    \"name\": \"eventDataGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"eventData\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"conversionHappenedAt\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"conversionHappenedAt\",\n                \"displayValue\": \"Conversion Happened At\"\n              },\n              {\n                \"value\": \"currency\",\n                \"displayValue\": \"Currency\"\n              },\n              {\n                \"value\": \"amount\",\n                \"displayValue\": \"Amount\"\n              },\n              {\n                \"value\": \"eventId\",\n                \"displayValue\": \"Event ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\",\n        \"valueValidators\": []\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Ids Override\",\n    \"name\": \"userIdsGroup\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"LABEL\",\n        \"name\": \"userIdsLabel\",\n        \"displayName\": \"Tag will attempt to parse cookie/event data but you can provide those parameter explicitly, at least one identifier is needed for a successful request.\"\n      },\n      {\n        \"name\": \"userIds\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"email\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"email\",\n                \"displayValue\": \"SHA256_EMAIL\"\n              },\n              {\n                \"value\": \"linkedinFirstPartyId\",\n                \"displayValue\": \"LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID\"\n              },\n              {\n                \"value\": \"acxiomID\",\n                \"displayValue\": \"ACXIOM ID\"\n              },\n              {\n                \"value\": \"moatID\",\n                \"displayValue\": \"ORACLE_MOAT_ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Info Override\",\n    \"name\": \"userInfoGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"userInfo\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"firstName\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"firstName\",\n                \"displayValue\": \"First Name\"\n              },\n              {\n                \"value\": \"lastName\",\n                \"displayValue\": \"Last Name\"\n              },\n              {\n                \"value\": \"jobTitle\",\n                \"displayValue\": \"Job Title\"\n              },\n              {\n                \"value\": \"companyName\",\n                \"displayValue\": \"Company Name\"\n              },\n              {\n                \"value\": \"countryCode\",\n                \"displayValue\": \"Country Code\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"consentSettingsGroup\",\n    \"displayName\": \"Consent Settings\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"adStorageConsent\",\n        \"displayName\": \"\",\n        \"radioItems\": [\n          {\n            \"value\": \"optional\",\n            \"displayValue\": \"Send data always\"\n          },\n          {\n            \"value\": \"required\",\n            \"displayValue\": \"Send data in case marketing consent given\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"optional\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Logs Settings\",\n    \"name\": \"logsGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"logType\",\n        \"radioItems\": [\n          {\n            \"value\": \"no\",\n            \"displayValue\": \"Do not log\"\n          },\n          {\n            \"value\": \"debug\",\n            \"displayValue\": \"Log to console during debug and preview\"\n          },\n          {\n            \"value\": \"always\",\n            \"displayValue\": \"Always log to console\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"debug\"\n      }\n    ]\n  }\n]\n\n\n___SANDBOXED_JS_FOR_SERVER___\n\nconst getAllEventData = require('getAllEventData');\nconst JSON = require('JSON');\nconst sendHttpRequest = require('sendHttpRequest');\nconst getContainerVersion = require('getContainerVersion');\nconst logToConsole = require('logToConsole');\nconst sha256Sync = require('sha256Sync');\nconst getRequestHeader = require('getRequestHeader');\nconst getType = require('getType');\nconst makeString = require('makeString');\nconst encodeUriComponent = require('encodeUriComponent');\nconst getTimestampMillis = require('getTimestampMillis');\nconst Math = require('Math');\nconst makeNumber = require('makeNumber');\nconst makeTableMap = require('makeTableMap');\nconst getCookieValues = require('getCookieValues');\nconst decodeUriComponent = require('decodeUriComponent');\nconst parseUrl = require('parseUrl');\nconst setCookie = require('setCookie');\n\nconst isLoggingEnabled = determinateIsLoggingEnabled();\nconst traceId = isLoggingEnabled ? getRequestHeader('trace-id') : undefined;\nconst cookieName = 'li_fat_id';\n\nconst eventData = getAllEventData();\n\nif (!isConsentGivenOrNotRequired()) {\n  return data.gtmOnSuccess();\n}\n\nif (data.type === 'page_view') {\n  const url = eventData.page_location || getRequestHeader('referer');\n\n  if (url) {\n    const value = parseUrl(url).searchParams[cookieName];\n\n    if (value) {\n      const options = {\n        domain: 'auto',\n        path: '/',\n        secure: true,\n        httpOnly: false,\n        'max-age': 86400 * 90\n      };\n\n      setCookie(cookieName, value, options, false);\n    }\n  }\n\n  return data.gtmOnSuccess();\n}\n\nconst user_data = eventData.user_data || {};\n\nlet user_address = user_data.address;\nif (['array', 'object'].indexOf(getType(user_address)) === -1) {\n  user_address = {};\n}\nuser_address = user_address[0] || user_address || {};\n\nconst eventDataOverride = makeOverrideTableMap(data.eventData);\nconst userIdsOverride = makeOverrideTableMap(data.userIds);\nconst userInfoOverride = makeOverrideTableMap(data.userInfo);\n\nconst postUrl = getRequestUrl();\nconst postBody = getPostBody();\nconst postHeaders = getRequestHeaders();\n\nif (isLoggingEnabled) {\n  logToConsole(\n    JSON.stringify({\n      Name: 'LinkedIn',\n      Type: 'Request',\n      TraceId: traceId,\n      EventName: postBody.eventId,\n      RequestMethod: 'POST',\n      RequestUrl: postUrl,\n      RequestBody: postBody\n    })\n  );\n}\n\n// perform validation check on presence of 1/4 of the required IDs. If at least 1 ID is present, make the API call. If no IDs are present, log the warning and no call is made\nif (validateUserData()) {\n  sendConversionToLinkedIn();\n} else {\n  if (isLoggingEnabled) {\n    logToConsole(\n      JSON.stringify({\n        Name: 'LinkedIn',\n        Type: 'Message',\n        TraceId: traceId,\n        EventName: postBody.eventId,\n        Message: 'No conversion event was sent to LinkedIn CAPI.',\n        Reason:\n          'You must set 1 out of the 4 acceptable IDs (SHA256_EMAIL, LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID, ACXIOM_ID, ORACLE_MOAT_ID) to resolve this issue or make certain to send both firstName and lastName.'\n      })\n    );\n  }\n\n  data.gtmOnFailure();\n}\n\nfunction validateUserData() {\n  if (postBody.user.userIds.length > 0) {\n    return true;\n  }\n\n  return postBody.user.userInfo.firstName && postBody.user.userInfo.lastName;\n}\n\nfunction sendConversionToLinkedIn() {\n  sendHttpRequest(\n    postUrl,\n    (statusCode, headers, body) => {\n      if (isLoggingEnabled) {\n        logToConsole(\n          JSON.stringify({\n            Name: 'LinkedIn',\n            Type: 'Response',\n            TraceId: traceId,\n            EventName: postBody.eventId,\n            ResponseStatusCode: statusCode,\n            ResponseHeaders: headers,\n            ResponseBody: body\n          })\n        );\n      }\n\n      if (statusCode >= 200 && statusCode < 300) {\n        data.gtmOnSuccess();\n      } else {\n        data.gtmOnFailure();\n      }\n    },\n    {\n      headers: postHeaders,\n      method: 'POST'\n    },\n    JSON.stringify(postBody)\n  );\n}\n\nfunction getRequestUrl() {\n  return 'https://api.linkedin.com/rest/conversionEvents';\n}\n\nfunction getRequestHeaders() {\n  return {\n    'Content-Type': 'application/json',\n    Authorization: 'Bearer ' + data.accessToken,\n    'LinkedIn-Version': '202506',\n    'X-Restli-Protocol-Version': '2.0.0'\n  };\n}\n\nfunction getPostBody() {\n  const result = {\n    conversion: getConversionRuleUrn(),\n    conversionHappenedAt: getConversionHappenedAt(),\n    eventId: getEventId(),\n    user: {\n      userIds: getUserIds(),\n      userInfo: getUserInfo()\n    }\n  };\n  const conversionValue = getConversionValue();\n  if (conversionValue) result.conversionValue = conversionValue;\n  return result;\n}\n\nfunction getConversionRuleUrn() {\n  return 'urn:lla:llaPartnerConversion:' + data.conversionRuleUrn;\n}\n\nfunction getConversionHappenedAt() {\n  if (eventDataOverride.conversionHappenedAt)\n    return makeNumber(eventDataOverride.conversionHappenedAt);\n  if (eventData.conversion_happened_at)\n    return makeNumber(eventData.conversion_happened_at);\n  if (eventData.event_time) return makeNumber(eventData.event_time);\n  return Math.round(getTimestampMillis());\n}\n\nfunction getConversionValue() {\n  const hasItems = getType(eventData.items) === 'array' && !!eventData.items[0];\n  const itemsCurrency = hasItems ? eventData.items[0].currency : '';\n  const currencyCode =\n    eventDataOverride.currency || eventData.currency || itemsCurrency;\n  if (!currencyCode) return null;\n  const itemsValue = hasItems\n    ? eventData.items.reduce((acc, item) => {\n        const price = item.price || 0;\n        const quantity = item.quantity || 1;\n        return acc + price * quantity;\n      }, 0)\n    : 0;\n  const amount = eventDataOverride.amount || eventData.value || itemsValue;\n  return {\n    currencyCode: currencyCode,\n    amount: makeString(amount)\n  };\n}\n\nfunction getEventId() {\n  return (\n    eventDataOverride.eventId || eventData.eventId || eventData.event_id || ''\n  );\n}\n\nfunction getUserIds() {\n  const userIds = [\n    {\n      idType: 'SHA256_EMAIL',\n      idValue: hashData(getUserEmail())\n    },\n    {\n      idType: 'LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID',\n      idValue: getLinkedInFirstPartyAdsTrackingUuid()\n    },\n    {\n      idType: 'ACXIOM_ID',\n      idValue: getAcxiomId()\n    },\n    {\n      idType: 'ORACLE_MOAT_ID',\n      idValue: getOracleMoatId()\n    }\n  ];\n\n  return userIds.filter((userId) => userId.idValue);\n}\n\nfunction getUserIdFactory(idType, getIdValue) {\n  return {\n    idType: idType,\n    idValue: getIdValue\n  };\n}\n\nfunction getUserEmail() {\n  return (\n    userIdsOverride.email ||\n    eventData.email ||\n    user_data.email_address ||\n    user_data.email ||\n    ''\n  );\n}\n\nfunction getLinkedInFirstPartyAdsTrackingUuid() {\n  const liFatId = decodeUriComponent(getCookieValues(cookieName)[0] || '');\n  return (\n    liFatId ||\n    userIdsOverride.linkedinFirstPartyId ||\n    user_data.linkedinFirstPartyId ||\n    ''\n  );\n}\n\nfunction getAcxiomId() {\n  return userIdsOverride.acxiomID || user_data.acxiomID || '';\n}\n\nfunction getOracleMoatId() {\n  return userIdsOverride.moatID || user_data.moatID || '';\n}\n\nfunction getUserFirstName() {\n  return (\n    userInfoOverride.firstName ||\n    eventData.firstName ||\n    eventData.FirstName ||\n    eventData.nameFirst ||\n    eventData.first_name ||\n    user_data.first_name ||\n    user_address.first_name ||\n    ''\n  );\n}\n\nfunction getUserLastName() {\n  return (\n    userInfoOverride.lastName ||\n    eventData.lastName ||\n    eventData.LastName ||\n    eventData.nameLast ||\n    eventData.last_name ||\n    user_data.last_name ||\n    user_address.last_name ||\n    ''\n  );\n}\n\nfunction getUserJobTitle() {\n  return (\n    userInfoOverride.jobTitle ||\n    eventData.jobTitle ||\n    user_data.jobTitle ||\n    user_data.job_title ||\n    ''\n  );\n}\n\nfunction getUserCompanyName() {\n  return (\n    userInfoOverride.companyName ||\n    eventData.companyName ||\n    eventData.company_name ||\n    user_data.companyName ||\n    user_data.company_name ||\n    ''\n  );\n}\n\nfunction getUserCountryCode() {\n  return (\n    userInfoOverride.countryCode ||\n    eventData.countryCode ||\n    eventData.country ||\n    user_data.country ||\n    user_address.country ||\n    ''\n  );\n}\n\nfunction getUserInfo() {\n  return {\n    firstName: getUserFirstName(),\n    lastName: getUserLastName(),\n    title: getUserJobTitle(),\n    companyName: getUserCompanyName(),\n    countryCode: getUserCountryCode()\n  };\n}\n\nfunction isHashed(value) {\n  if (!value) {\n    return false;\n  }\n\n  return makeString(value).match('^[A-Fa-f0-9]{64}$') !== null;\n}\n\nfunction hashData(value) {\n  if (!value) {\n    return value;\n  }\n\n  const type = getType(value);\n\n  if (type === 'undefined' || value === 'undefined') {\n    return undefined;\n  }\n\n  if (type === 'object' || type === 'array') {\n    return value;\n  }\n\n  if (isHashed(value)) {\n    return value;\n  }\n\n  value = makeString(value).trim().toLowerCase();\n\n  return sha256Sync(value, { outputEncoding: 'hex' });\n}\n\nfunction enc(data) {\n  return encodeUriComponent(data || '');\n}\n\nfunction makeOverrideTableMap(values) {\n  return makeTableMap(values || [], 'name', 'value') || {};\n}\n\nfunction determinateIsLoggingEnabled() {\n  const containerVersion = getContainerVersion();\n  const isDebug = !!(\n    containerVersion &&\n    (containerVersion.debugMode || containerVersion.previewMode)\n  );\n\n  if (!data.logType) {\n    return isDebug;\n  }\n\n  if (data.logType === 'no') {\n    return false;\n  }\n\n  if (data.logType === 'debug') {\n    return isDebug;\n  }\n\n  return data.logType === 'always';\n}\n\nfunction isConsentGivenOrNotRequired() {\n  if (data.adStorageConsent !== 'required') return true;\n  if (eventData.consent_state) return !!eventData.consent_state.ad_storage;\n  const xGaGcs = eventData['x-ga-gcs'] || ''; // x-ga-gcs is a string like \"G110\"\n  return xGaGcs[2] === '1';\n}\n\n\n___SERVER_PERMISSIONS___\n\n[\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_request\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"headerWhitelist\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"trace-id\"\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"referer\"\n                  }\n                ]\n              }\n            ]\n          }\n        },\n        {\n          \"key\": \"headersAllowed\",\n          \"value\": {\n            \"type\": 8,\n            \"boolean\": true\n          }\n        },\n        {\n          \"key\": \"requestAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"headerAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"queryParameterAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"logging\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"environments\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"all\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_container_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_event_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"eventDataAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"send_http\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedUrls\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"urls\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"https://api.linkedin.com/rest/conversionEvents\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"cookieAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"cookieNames\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"li_fat_id\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"set_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedCookies\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"name\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"domain\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"path\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"secure\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"session\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"li_fat_id\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: User data address is object and properties are at the root level\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      country:\\\n    \\ \\\"Brazil\\\",\\n      first_name: \\\"Test First Name\\\",\\n      last_name: \\\"Test\\\n    \\ Last Name\\\",\\n      qweqwewa: 123123\\n    }   \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address.first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address.last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address.country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is object with properties in a nested object in the '0'\n    key\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      0:\\\n    \\ {\\n        country: \\\"Brazil\\\",\\n        first_name: \\\"Test First Name\\\",\\n\\\n    \\        last_name: \\\"Test Last Name\\\"\\n      }\\n    }  \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is array with properties in an object at the first position\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: [{\\n      first_name:\\\n    \\ \\\"Test First Name\\\",\\n      last_name: \\\"Test Last Name\\\",\\n      country: \\\"\\\n    Brazil\\\",\\n      postal_code: \\\"example.com\\\"\\n    }]\\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is empty object\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com',\\n\\\n    \\    address: {}\\n  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\n\\\n    mock('sendHttpRequest', function(url, callback, headers, body) {\\n  const parsedBody\\\n    \\ = JSON.parse(body);\\n  if (parsedBody && parsedBody.user && parsedBody.user.userInfo)\\\n    \\ {\\n    if (\\n      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is not supplied\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com'\\n\\\n    \\  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\nmock('sendHttpRequest',\\\n    \\ function(url, callback, headers, body) {\\n  const parsedBody = JSON.parse(body);\\n\\\n    \\  if (parsedBody && parsedBody.user && parsedBody.user.userInfo) {\\n    if (\\n\\\n    \\      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\nsetup: |-\n  const JSON = require('JSON');\n\n  const mockData = {\n    \"type\": \"conversion\",\n    \"accessToken\": \"token\",\n    \"conversionRuleUrn\": \"123123\"\n  };\n\n\n___NOTES___\n\nCreated on 18/08/2022, 12:25:26\n\n\n",
        "galleryReference": {
          "host": "github.com",
          "owner": "stape-io",
          "repository": "linkedin-tag",
          "version": "94000fb78f50b2442788a620ae34628cfbf16910",
          "signature": "fd3b56138ac116517f44b843f38b7f1ed24ea520e722b7c87414dc1aa8c35982"
        }
      }
    },
    {
      "name": "gtm_update_template",
      "status": "pass",
      "details": {
        "templateId": "66",
        "name": "LinkedIn Conversion API",
        "path": "accounts/572865630/containers/208950707/workspaces/19/templates/66",
        "fingerprint": "1770808807960",
        "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"TAG\",\n  \"id\": \"cvt_PBNHC\",\n  \"version\": 1,\n  \"displayName\": \"LinkedIn Conversion API\",\n  \"brand\": {\n    \"id\": \"github.com_stape-io\",\n    \"displayName\": \"stape-io\",\n    \"thumbnail\": \"data:image/png;base64,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\\u003d\\u003d\"\n  },\n  \"description\": \"Tag that sends the event data from the GA4/Data client to LinkedIn Conversion API.\",\n  \"containerContexts\": [\n    \"SERVER\"\n  ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"type\",\n    \"displayName\": \"Event Type\",\n    \"radioItems\": [\n      {\n        \"value\": \"page_view\",\n        \"displayValue\": \"Page View\"\n      },\n      {\n        \"value\": \"conversion\",\n        \"displayValue\": \"Conversion\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"help\": \"\\u003cb\\u003ePage View\\u003c/b\\u003e - stores the li_fat_id URL parameter inside the li_fat_id cookie\\u003cbr\\u003e\\u003cbr\\u003e \\u003cb\\u003eConversion\\u003c/b\\u003e - Send request with data about the conversion to the LinkedIn\",\n    \"defaultValue\": \"conversion\"\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"accessToken\",\n    \"displayName\": \"Access Token\",\n    \"simpleValueType\": true,\n    \"help\": \"LinkedIn API access token \\u003ca href\\u003d\\\"https://www.linkedin.com/help/lms/answer/a1718034\\\"\\u003eLearn more\\u003c/a\\u003e\",\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"conversionRuleUrn\",\n    \"displayName\": \"Conversion Rule ID\",\n    \"simpleValueType\": true,\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Event Data Override\",\n    \"name\": \"eventDataGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"eventData\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"conversionHappenedAt\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"conversionHappenedAt\",\n                \"displayValue\": \"Conversion Happened At\"\n              },\n              {\n                \"value\": \"currency\",\n                \"displayValue\": \"Currency\"\n              },\n              {\n                \"value\": \"amount\",\n                \"displayValue\": \"Amount\"\n              },\n              {\n                \"value\": \"eventId\",\n                \"displayValue\": \"Event ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\",\n        \"valueValidators\": []\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Ids Override\",\n    \"name\": \"userIdsGroup\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"LABEL\",\n        \"name\": \"userIdsLabel\",\n        \"displayName\": \"Tag will attempt to parse cookie/event data but you can provide those parameter explicitly, at least one identifier is needed for a successful request.\"\n      },\n      {\n        \"name\": \"userIds\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"email\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"email\",\n                \"displayValue\": \"SHA256_EMAIL\"\n              },\n              {\n                \"value\": \"linkedinFirstPartyId\",\n                \"displayValue\": \"LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID\"\n              },\n              {\n                \"value\": \"acxiomID\",\n                \"displayValue\": \"ACXIOM ID\"\n              },\n              {\n                \"value\": \"moatID\",\n                \"displayValue\": \"ORACLE_MOAT_ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"User Info Override\",\n    \"name\": \"userInfoGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"name\": \"userInfo\",\n        \"simpleTableColumns\": [\n          {\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"defaultValue\": \"firstName\",\n            \"displayName\": \"Property Name\",\n            \"name\": \"name\",\n            \"isUnique\": true,\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"firstName\",\n                \"displayValue\": \"First Name\"\n              },\n              {\n                \"value\": \"lastName\",\n                \"displayValue\": \"Last Name\"\n              },\n              {\n                \"value\": \"jobTitle\",\n                \"displayValue\": \"Job Title\"\n              },\n              {\n                \"value\": \"companyName\",\n                \"displayValue\": \"Company Name\"\n              },\n              {\n                \"value\": \"countryCode\",\n                \"displayValue\": \"Country Code\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Property Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"type\": \"SIMPLE_TABLE\",\n        \"newRowButtonText\": \"Add property\"\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"type\",\n        \"paramValue\": \"conversion\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"consentSettingsGroup\",\n    \"displayName\": \"Consent Settings\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"adStorageConsent\",\n        \"displayName\": \"\",\n        \"radioItems\": [\n          {\n            \"value\": \"optional\",\n            \"displayValue\": \"Send data always\"\n          },\n          {\n            \"value\": \"required\",\n            \"displayValue\": \"Send data in case marketing consent given\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"optional\"\n      }\n    ]\n  },\n  {\n    \"displayName\": \"Logs Settings\",\n    \"name\": \"logsGroup\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"type\": \"GROUP\",\n    \"subParams\": [\n      {\n        \"type\": \"RADIO\",\n        \"name\": \"logType\",\n        \"radioItems\": [\n          {\n            \"value\": \"no\",\n            \"displayValue\": \"Do not log\"\n          },\n          {\n            \"value\": \"debug\",\n            \"displayValue\": \"Log to console during debug and preview\"\n          },\n          {\n            \"value\": \"always\",\n            \"displayValue\": \"Always log to console\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"debug\"\n      }\n    ]\n  }\n]\n\n\n___SANDBOXED_JS_FOR_SERVER___\n\nconst getAllEventData = require('getAllEventData');\nconst JSON = require('JSON');\nconst sendHttpRequest = require('sendHttpRequest');\nconst getContainerVersion = require('getContainerVersion');\nconst logToConsole = require('logToConsole');\nconst sha256Sync = require('sha256Sync');\nconst getRequestHeader = require('getRequestHeader');\nconst getType = require('getType');\nconst makeString = require('makeString');\nconst encodeUriComponent = require('encodeUriComponent');\nconst getTimestampMillis = require('getTimestampMillis');\nconst Math = require('Math');\nconst makeNumber = require('makeNumber');\nconst makeTableMap = require('makeTableMap');\nconst getCookieValues = require('getCookieValues');\nconst decodeUriComponent = require('decodeUriComponent');\nconst parseUrl = require('parseUrl');\nconst setCookie = require('setCookie');\n\nconst isLoggingEnabled = determinateIsLoggingEnabled();\nconst traceId = isLoggingEnabled ? getRequestHeader('trace-id') : undefined;\nconst cookieName = 'li_fat_id';\n\nconst eventData = getAllEventData();\n\nif (!isConsentGivenOrNotRequired()) {\n  return data.gtmOnSuccess();\n}\n\nif (data.type === 'page_view') {\n  const url = eventData.page_location || getRequestHeader('referer');\n\n  if (url) {\n    const value = parseUrl(url).searchParams[cookieName];\n\n    if (value) {\n      const options = {\n        domain: 'auto',\n        path: '/',\n        secure: true,\n        httpOnly: false,\n        'max-age': 86400 * 90\n      };\n\n      setCookie(cookieName, value, options, false);\n    }\n  }\n\n  return data.gtmOnSuccess();\n}\n\nconst user_data = eventData.user_data || {};\n\nlet user_address = user_data.address;\nif (['array', 'object'].indexOf(getType(user_address)) === -1) {\n  user_address = {};\n}\nuser_address = user_address[0] || user_address || {};\n\nconst eventDataOverride = makeOverrideTableMap(data.eventData);\nconst userIdsOverride = makeOverrideTableMap(data.userIds);\nconst userInfoOverride = makeOverrideTableMap(data.userInfo);\n\nconst postUrl = getRequestUrl();\nconst postBody = getPostBody();\nconst postHeaders = getRequestHeaders();\n\nif (isLoggingEnabled) {\n  logToConsole(\n    JSON.stringify({\n      Name: 'LinkedIn',\n      Type: 'Request',\n      TraceId: traceId,\n      EventName: postBody.eventId,\n      RequestMethod: 'POST',\n      RequestUrl: postUrl,\n      RequestBody: postBody\n    })\n  );\n}\n\n// perform validation check on presence of 1/4 of the required IDs. If at least 1 ID is present, make the API call. If no IDs are present, log the warning and no call is made\nif (validateUserData()) {\n  sendConversionToLinkedIn();\n} else {\n  if (isLoggingEnabled) {\n    logToConsole(\n      JSON.stringify({\n        Name: 'LinkedIn',\n        Type: 'Message',\n        TraceId: traceId,\n        EventName: postBody.eventId,\n        Message: 'No conversion event was sent to LinkedIn CAPI.',\n        Reason:\n          'You must set 1 out of the 4 acceptable IDs (SHA256_EMAIL, LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID, ACXIOM_ID, ORACLE_MOAT_ID) to resolve this issue or make certain to send both firstName and lastName.'\n      })\n    );\n  }\n\n  data.gtmOnFailure();\n}\n\nfunction validateUserData() {\n  if (postBody.user.userIds.length > 0) {\n    return true;\n  }\n\n  return postBody.user.userInfo.firstName && postBody.user.userInfo.lastName;\n}\n\nfunction sendConversionToLinkedIn() {\n  sendHttpRequest(\n    postUrl,\n    (statusCode, headers, body) => {\n      if (isLoggingEnabled) {\n        logToConsole(\n          JSON.stringify({\n            Name: 'LinkedIn',\n            Type: 'Response',\n            TraceId: traceId,\n            EventName: postBody.eventId,\n            ResponseStatusCode: statusCode,\n            ResponseHeaders: headers,\n            ResponseBody: body\n          })\n        );\n      }\n\n      if (statusCode >= 200 && statusCode < 300) {\n        data.gtmOnSuccess();\n      } else {\n        data.gtmOnFailure();\n      }\n    },\n    {\n      headers: postHeaders,\n      method: 'POST'\n    },\n    JSON.stringify(postBody)\n  );\n}\n\nfunction getRequestUrl() {\n  return 'https://api.linkedin.com/rest/conversionEvents';\n}\n\nfunction getRequestHeaders() {\n  return {\n    'Content-Type': 'application/json',\n    Authorization: 'Bearer ' + data.accessToken,\n    'LinkedIn-Version': '202506',\n    'X-Restli-Protocol-Version': '2.0.0'\n  };\n}\n\nfunction getPostBody() {\n  const result = {\n    conversion: getConversionRuleUrn(),\n    conversionHappenedAt: getConversionHappenedAt(),\n    eventId: getEventId(),\n    user: {\n      userIds: getUserIds(),\n      userInfo: getUserInfo()\n    }\n  };\n  const conversionValue = getConversionValue();\n  if (conversionValue) result.conversionValue = conversionValue;\n  return result;\n}\n\nfunction getConversionRuleUrn() {\n  return 'urn:lla:llaPartnerConversion:' + data.conversionRuleUrn;\n}\n\nfunction getConversionHappenedAt() {\n  if (eventDataOverride.conversionHappenedAt)\n    return makeNumber(eventDataOverride.conversionHappenedAt);\n  if (eventData.conversion_happened_at)\n    return makeNumber(eventData.conversion_happened_at);\n  if (eventData.event_time) return makeNumber(eventData.event_time);\n  return Math.round(getTimestampMillis());\n}\n\nfunction getConversionValue() {\n  const hasItems = getType(eventData.items) === 'array' && !!eventData.items[0];\n  const itemsCurrency = hasItems ? eventData.items[0].currency : '';\n  const currencyCode =\n    eventDataOverride.currency || eventData.currency || itemsCurrency;\n  if (!currencyCode) return null;\n  const itemsValue = hasItems\n    ? eventData.items.reduce((acc, item) => {\n        const price = item.price || 0;\n        const quantity = item.quantity || 1;\n        return acc + price * quantity;\n      }, 0)\n    : 0;\n  const amount = eventDataOverride.amount || eventData.value || itemsValue;\n  return {\n    currencyCode: currencyCode,\n    amount: makeString(amount)\n  };\n}\n\nfunction getEventId() {\n  return (\n    eventDataOverride.eventId || eventData.eventId || eventData.event_id || ''\n  );\n}\n\nfunction getUserIds() {\n  const userIds = [\n    {\n      idType: 'SHA256_EMAIL',\n      idValue: hashData(getUserEmail())\n    },\n    {\n      idType: 'LINKEDIN_FIRST_PARTY_ADS_TRACKING_UUID',\n      idValue: getLinkedInFirstPartyAdsTrackingUuid()\n    },\n    {\n      idType: 'ACXIOM_ID',\n      idValue: getAcxiomId()\n    },\n    {\n      idType: 'ORACLE_MOAT_ID',\n      idValue: getOracleMoatId()\n    }\n  ];\n\n  return userIds.filter((userId) => userId.idValue);\n}\n\nfunction getUserIdFactory(idType, getIdValue) {\n  return {\n    idType: idType,\n    idValue: getIdValue\n  };\n}\n\nfunction getUserEmail() {\n  return (\n    userIdsOverride.email ||\n    eventData.email ||\n    user_data.email_address ||\n    user_data.email ||\n    ''\n  );\n}\n\nfunction getLinkedInFirstPartyAdsTrackingUuid() {\n  const liFatId = decodeUriComponent(getCookieValues(cookieName)[0] || '');\n  return (\n    liFatId ||\n    userIdsOverride.linkedinFirstPartyId ||\n    user_data.linkedinFirstPartyId ||\n    ''\n  );\n}\n\nfunction getAcxiomId() {\n  return userIdsOverride.acxiomID || user_data.acxiomID || '';\n}\n\nfunction getOracleMoatId() {\n  return userIdsOverride.moatID || user_data.moatID || '';\n}\n\nfunction getUserFirstName() {\n  return (\n    userInfoOverride.firstName ||\n    eventData.firstName ||\n    eventData.FirstName ||\n    eventData.nameFirst ||\n    eventData.first_name ||\n    user_data.first_name ||\n    user_address.first_name ||\n    ''\n  );\n}\n\nfunction getUserLastName() {\n  return (\n    userInfoOverride.lastName ||\n    eventData.lastName ||\n    eventData.LastName ||\n    eventData.nameLast ||\n    eventData.last_name ||\n    user_data.last_name ||\n    user_address.last_name ||\n    ''\n  );\n}\n\nfunction getUserJobTitle() {\n  return (\n    userInfoOverride.jobTitle ||\n    eventData.jobTitle ||\n    user_data.jobTitle ||\n    user_data.job_title ||\n    ''\n  );\n}\n\nfunction getUserCompanyName() {\n  return (\n    userInfoOverride.companyName ||\n    eventData.companyName ||\n    eventData.company_name ||\n    user_data.companyName ||\n    user_data.company_name ||\n    ''\n  );\n}\n\nfunction getUserCountryCode() {\n  return (\n    userInfoOverride.countryCode ||\n    eventData.countryCode ||\n    eventData.country ||\n    user_data.country ||\n    user_address.country ||\n    ''\n  );\n}\n\nfunction getUserInfo() {\n  return {\n    firstName: getUserFirstName(),\n    lastName: getUserLastName(),\n    title: getUserJobTitle(),\n    companyName: getUserCompanyName(),\n    countryCode: getUserCountryCode()\n  };\n}\n\nfunction isHashed(value) {\n  if (!value) {\n    return false;\n  }\n\n  return makeString(value).match('^[A-Fa-f0-9]{64}$') !== null;\n}\n\nfunction hashData(value) {\n  if (!value) {\n    return value;\n  }\n\n  const type = getType(value);\n\n  if (type === 'undefined' || value === 'undefined') {\n    return undefined;\n  }\n\n  if (type === 'object' || type === 'array') {\n    return value;\n  }\n\n  if (isHashed(value)) {\n    return value;\n  }\n\n  value = makeString(value).trim().toLowerCase();\n\n  return sha256Sync(value, { outputEncoding: 'hex' });\n}\n\nfunction enc(data) {\n  return encodeUriComponent(data || '');\n}\n\nfunction makeOverrideTableMap(values) {\n  return makeTableMap(values || [], 'name', 'value') || {};\n}\n\nfunction determinateIsLoggingEnabled() {\n  const containerVersion = getContainerVersion();\n  const isDebug = !!(\n    containerVersion &&\n    (containerVersion.debugMode || containerVersion.previewMode)\n  );\n\n  if (!data.logType) {\n    return isDebug;\n  }\n\n  if (data.logType === 'no') {\n    return false;\n  }\n\n  if (data.logType === 'debug') {\n    return isDebug;\n  }\n\n  return data.logType === 'always';\n}\n\nfunction isConsentGivenOrNotRequired() {\n  if (data.adStorageConsent !== 'required') return true;\n  if (eventData.consent_state) return !!eventData.consent_state.ad_storage;\n  const xGaGcs = eventData['x-ga-gcs'] || ''; // x-ga-gcs is a string like \"G110\"\n  return xGaGcs[2] === '1';\n}\n\n\n___SERVER_PERMISSIONS___\n\n[\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_request\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"headerWhitelist\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"trace-id\"\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"headerName\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"referer\"\n                  }\n                ]\n              }\n            ]\n          }\n        },\n        {\n          \"key\": \"headersAllowed\",\n          \"value\": {\n            \"type\": 8,\n            \"boolean\": true\n          }\n        },\n        {\n          \"key\": \"requestAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"headerAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"queryParameterAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"logging\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"environments\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"all\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_container_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_event_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"eventDataAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"send_http\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedUrls\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"urls\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"https://api.linkedin.com/rest/conversionEvents\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"cookieAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"cookieNames\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"li_fat_id\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"set_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedCookies\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"name\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"domain\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"path\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"secure\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"session\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"li_fat_id\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  }\n]\n\n\n___TESTS___\n\nscenarios:\n- name: User data address is object and properties are at the root level\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      country:\\\n    \\ \\\"Brazil\\\",\\n      first_name: \\\"Test First Name\\\",\\n      last_name: \\\"Test\\\n    \\ Last Name\\\",\\n      qweqwewa: 123123\\n    }   \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address.first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address.last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address.country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is object with properties in a nested object in the '0'\n    key\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: {\\n      0:\\\n    \\ {\\n        country: \\\"Brazil\\\",\\n        first_name: \\\"Test First Name\\\",\\n\\\n    \\        last_name: \\\"Test Last Name\\\"\\n      }\\n    }  \\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is array with properties in an object at the first position\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    address: [{\\n      first_name:\\\n    \\ \\\"Test First Name\\\",\\n      last_name: \\\"Test Last Name\\\",\\n      country: \\\"\\\n    Brazil\\\",\\n      postal_code: \\\"example.com\\\"\\n    }]\\n  }\\n};\\n\\nmock('getAllEventData',\\\n    \\ mockGetAllEventData);\\n\\nmock('sendHttpRequest', function(url, callback, headers,\\\n    \\ body) {\\n  const parsedBody = JSON.parse(body);\\n  if (parsedBody && parsedBody.user\\\n    \\ && parsedBody.user.userInfo) {\\n    assertThat(parsedBody.user.userInfo.firstName).isEqualTo(mockGetAllEventData.user_data.address[0].first_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.lastName).isEqualTo(mockGetAllEventData.user_data.address[0].last_name);\\n\\\n    \\    assertThat(parsedBody.user.userInfo.countryCode).isEqualTo(mockGetAllEventData.user_data.address[0].country);\\n\\\n    \\  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is empty object\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com',\\n\\\n    \\    address: {}\\n  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\n\\\n    mock('sendHttpRequest', function(url, callback, headers, body) {\\n  const parsedBody\\\n    \\ = JSON.parse(body);\\n  if (parsedBody && parsedBody.user && parsedBody.user.userInfo)\\\n    \\ {\\n    if (\\n      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\n- name: User data address is not supplied\n  code: \"const mockGetAllEventData = {\\n  user_data: { \\n    email: 'test@example.com'\\n\\\n    \\  }\\n};\\n\\nmock('getAllEventData', mockGetAllEventData);\\n\\nmock('sendHttpRequest',\\\n    \\ function(url, callback, headers, body) {\\n  const parsedBody = JSON.parse(body);\\n\\\n    \\  if (parsedBody && parsedBody.user && parsedBody.user.userInfo) {\\n    if (\\n\\\n    \\      parsedBody.user.userInfo.firstName ||\\n      parsedBody.user.userInfo.lastName\\\n    \\ ||\\n      parsedBody.user.userInfo.countryCode\\n    ) {\\n      fail('firstName,\\\n    \\ lastName and countryCode shouldn\\\\'t be present when user_data.address is not\\\n    \\ supplied.');\\n    }\\n  }\\n});\\n\\nrunCode(mockData);\"\nsetup: |-\n  const JSON = require('JSON');\n\n  const mockData = {\n    \"type\": \"conversion\",\n    \"accessToken\": \"token\",\n    \"conversionRuleUrn\": \"123123\"\n  };\n\n\n___NOTES___\n\nCreated on 18/08/2022, 12:25:26\n\n\n"
      }
    },
    {
      "name": "gtm_revert_template",
      "status": "pass",
      "details": {
        "templateId": "",
        "name": "",
        "path": "accounts/572865630/containers/208950707/workspaces/19/templates/66",
        "revertedDeletedInBase": true
      }
    },
    {
      "name": "gtm_list_clients",
      "status": "pass",
      "details": {
        "summary": {
          "total": 1,
          "byType": {
            "gaaw_client": 1
          }
        },
        "clients": [
          {
            "clientId": "23",
            "name": "GA4 Client",
            "type": "gaaw_client",
            "path": "accounts/572865630/containers/208950707/workspaces/19/clients/23"
          }
        ]
      }
    },
    {
      "name": "gtm_get_client_seed",
      "status": "skip",
      "details": "Skipped: no existing client available as seed"
    },
    {
      "name": "gtm_create_client",
      "status": "pass",
      "details": {
        "clientId": "67",
        "name": "MCP Selftest Client 2026-02-11T11-18-11-050Z",
        "type": "gaaw_client",
        "path": "accounts/572865630/containers/208950707/workspaces/19/clients/67",
        "fingerprint": "1770808819693",
        "priority": 100
      }
    },
    {
      "name": "gtm_get_client",
      "status": "pass",
      "details": {
        "clientId": "67",
        "name": "MCP Selftest Client 2026-02-11T11-18-11-050Z",
        "type": "gaaw_client",
        "path": "accounts/572865630/containers/208950707/workspaces/19/clients/67",
        "fingerprint": "1770808819693",
        "priority": 100
      }
    },
    {
      "name": "gtm_update_client",
      "status": "pass",
      "details": {
        "clientId": "67",
        "name": "MCP Selftest Client Updated 2026-02-11T11-18-11-050Z",
        "type": "gaaw_client",
        "path": "accounts/572865630/containers/208950707/workspaces/19/clients/67",
        "fingerprint": "1770808831711",
        "priority": 100
      }
    },
    {
      "name": "gtm_delete_client",
      "status": "pass",
      "details": {
        "deleted": true,
        "path": "accounts/572865630/containers/208950707/workspaces/19/clients/67"
      }
    },
    {
      "name": "gtm_list_transformations",
      "status": "pass",
      "details": []
    },
    {
      "name": "gtm_get_transformation_seed",
      "status": "skip",
      "details": "Skipped: no existing transformation available as seed"
    },
    {
      "name": "gtm_create_transformation",
      "status": "skip",
      "details": {
        "code": 500,
        "message": "Experienced an internal error.",
        "errorType": "UNKNOWN",
        "details": {
          "code": 500,
          "message": "Experienced an internal error.",
          "errors": [
            {
              "message": "Experienced an internal error.",
              "domain": "global",
              "reason": "backendError"
            }
          ],
          "status": "INTERNAL"
        },
        "help": "An unexpected error occurred. Check the error details for more information.",
        "suggestions": [
          "Check the error details for specific information",
          "Try the operation with validated parameters",
          "Use helper tools like gtm_validate_trigger_config"
        ],
        "example": null
      }
    },
    {
      "name": "gtm_get_transformation",
      "status": "skip",
      "details": "Skipped: transformation not created"
    },
    {
      "name": "gtm_update_transformation",
      "status": "skip",
      "details": "Skipped: transformation not created"
    },
    {
      "name": "gtm_delete_transformation",
      "status": "skip",
      "details": "Skipped: transformation not created"
    },
    {
      "name": "gtm_list_versions",
      "status": "pass",
      "details": [
        {
          "versionId": "1",
          "path": "accounts/572865630/containers/208950707/versions/1"
        },
        {
          "versionId": "2",
          "name": "Serverside Page_view",
          "path": "accounts/572865630/containers/208950707/versions/2"
        },
        {
          "versionId": "3",
          "name": "GA Optout Regel eingebaut",
          "path": "accounts/572865630/containers/208950707/versions/3"
        },
        {
          "versionId": "4",
          "name": "Schreibfehler korrigiert borlabs-cookie",
          "path": "accounts/572865630/containers/208950707/versions/4"
        },
        {
          "versionId": "5",
          "name": "Cookievalue korrektur",
          "path": "accounts/572865630/containers/208950707/versions/5"
        },
        {
          "versionId": "6",
          "name": "Web Vitals ergnzt",
          "path": "accounts/572865630/containers/208950707/versions/6"
        },
        {
          "versionId": "7",
          "name": "Scroll Added",
          "path": "accounts/572865630/containers/208950707/versions/7"
        },
        {
          "versionId": "8",
          "name": "GA4 video & click",
          "path": "accounts/572865630/containers/208950707/versions/8"
        },
        {
          "versionId": "9",
          "name": "piwik pro update",
          "path": "accounts/572865630/containers/208950707/versions/9"
        },
        {
          "versionId": "10",
          "name": "Umstellung uaf GA4 Client Tag",
          "path": "accounts/572865630/containers/208950707/versions/10"
        },
        {
          "versionId": "11",
          "name": "Simplify GA4 Setup all events",
          "path": "accounts/572865630/containers/208950707/versions/11"
        },
        {
          "versionId": "12",
          "name": "Tracking anhand consent signal",
          "path": "accounts/572865630/containers/208950707/versions/12"
        },
        {
          "versionId": "13",
          "path": "accounts/572865630/containers/208950707/versions/13"
        },
        {
          "versionId": "14",
          "name": "MCP Selftest Version 2026-02-11T10-06-51-418Z",
          "path": "accounts/572865630/containers/208950707/versions/14"
        },
        {
          "versionId": "15",
          "name": "MCP Selftest Version 2026-02-11T10-17-03-682Z",
          "path": "accounts/572865630/containers/208950707/versions/15"
        },
        {
          "versionId": "16",
          "name": "MCP Selftest Version 2026-02-11T11-04-59-014Z",
          "path": "accounts/572865630/containers/208950707/versions/16"
        }
      ]
    },
    {
      "name": "gtm_get_latest_version_header",
      "status": "pass",
      "details": {
        "versionId": "16",
        "name": "MCP Selftest Version 2026-02-11T11-04-59-014Z",
        "path": "accounts/572865630/containers/208950707/versions/16"
      }
    },
    {
      "name": "gtm_get_live_version",
      "status": "pass",
      "details": {
        "versionId": "13",
        "counts": {
          "tags": 4,
          "triggers": 8,
          "variables": 9,
          "folders": 0,
          "clients": 1
        },
        "tagTypes": {
          "sgtmgaaw": 1,
          "sgtmadscl": 1,
          "cvt_5TP8W": 1,
          "sgtmadsct": 1
        },
        "triggerTypes": {
          "customEvent": 8
        },
        "variableTypes": {
          "c": 5,
          "sgtmk": 1,
          "ed": 3
        }
      }
    },
    {
      "name": "gtm_create_version",
      "status": "pass",
      "details": {
        "versionId": "17",
        "name": "MCP Selftest Version 2026-02-11T11-18-11-050Z",
        "path": "accounts/572865630/containers/208950707/versions/17",
        "description": "Created by MCP selftest"
      }
    },
    {
      "name": "gtm_get_version",
      "status": "pass",
      "details": {
        "versionId": "17",
        "name": "MCP Selftest Version 2026-02-11T11-18-11-050Z",
        "counts": {
          "tags": 4,
          "triggers": 12,
          "variables": 13,
          "folders": 4,
          "clients": 1
        },
        "tagTypes": {
          "sgtmgaaw": 1,
          "sgtmadscl": 1,
          "cvt_5TP8W": 1,
          "sgtmadsct": 1
        },
        "triggerTypes": {
          "customEvent": 8,
          "always": 4
        },
        "variableTypes": {
          "c": 5,
          "sgtmk": 1,
          "ed": 3,
          "r": 4
        }
      }
    },
    {
      "name": "gtm_export_version",
      "status": "pass",
      "details": {
        "exportFormatVersion": 2,
        "exportTime": "2026-02-11T11:21:35.385Z",
        "containerVersion": {
          "path": "accounts/572865630/containers/208950707/versions/17",
          "accountId": "572865630",
          "containerId": "208950707",
          "containerVersionId": "17",
          "name": "MCP Selftest Version 2026-02-11T11-18-11-050Z",
          "container": {
            "path": "accounts/572865630/containers/208950707",
            "accountId": "572865630",
            "containerId": "208950707",
            "name": "Stape.io - tobiasbatke.com",
            "publicId": "GTM-KX4X75JJ",
            "usageContext": [
              "server"
            ],
            "fingerprint": "1742307839417",
            "tagManagerUrl": "https://tagmanager.google.com/#/container/accounts/572865630/containers/208950707/workspaces?apiLink=container",
            "features": {
              "supportUserPermissions": true,
              "supportEnvironments": true,
              "supportWorkspaces": true,
              "supportGtagConfigs": false,
              "supportBuiltInVariables": true,
              "supportClients": true,
              "supportFolders": true,
              "supportTags": true,
              "supportTemplates": true,
              "supportTriggers": true,
              "supportVariables": true,
              "supportVersions": true,
              "supportZones": true,
              "supportTransformations": true
            },
            "tagIds": [
              "GTM-KX4X75JJ"
            ],
            "taggingServerUrls": [
              "https://stats.tobiasbatke.com"
            ]
          },
          "tag": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "tagId": "25",
              "name": "GA4 - All Events",
              "type": "sgtmgaaw",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "redactVisitorIp",
                  "value": "true"
                },
                {
                  "type": "template",
                  "key": "epToIncludeDropdown",
                  "value": "all"
                },
                {
                  "type": "template",
                  "key": "upToIncludeDropdown",
                  "value": "all"
                },
                {
                  "type": "template",
                  "key": "measurementId",
                  "value": "{{GA4 - Property ID}}"
                }
              ],
              "fingerprint": "1751547951774",
              "firingTriggerId": [
                "24"
              ],
              "tagFiringOption": "oncePerEvent",
              "monitoringMetadata": {
                "type": "map"
              },
              "consentSettings": {
                "consentStatus": "notSet"
              }
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "tagId": "26",
              "name": "Conversion Linker",
              "type": "sgtmadscl",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "enableLinkerParams",
                  "value": "false"
                },
                {
                  "type": "boolean",
                  "key": "enableCookieOverrides",
                  "value": "false"
                }
              ],
              "fingerprint": "1763844148506",
              "firingTriggerId": [
                "22"
              ],
              "tagFiringOption": "oncePerEvent",
              "monitoringMetadata": {
                "type": "map"
              },
              "consentSettings": {
                "consentStatus": "notSet"
              }
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "tagId": "31",
              "name": "FB - PageView",
              "type": "cvt_5TP8W",
              "parameter": [
                {
                  "type": "template",
                  "key": "logType",
                  "value": "debug"
                },
                {
                  "type": "template",
                  "key": "adStorageConsent",
                  "value": "optional"
                },
                {
                  "type": "template",
                  "key": "eventNameStandard",
                  "value": "PageView"
                },
                {
                  "type": "boolean",
                  "key": "generateFbp",
                  "value": "true"
                },
                {
                  "type": "boolean",
                  "key": "overrideCookieDomain",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "accessToken",
                  "value": "{{FB - API Access Token}}"
                },
                {
                  "type": "boolean",
                  "key": "useAppSecretProof",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "inheritEventName",
                  "value": "override"
                },
                {
                  "type": "template",
                  "key": "actionSource",
                  "value": "website"
                },
                {
                  "type": "template",
                  "key": "pixelId",
                  "value": "{{FB - Pixel ID}}"
                },
                {
                  "type": "boolean",
                  "key": "useHttpOnlyCookie",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "itemIdKey"
                },
                {
                  "type": "boolean",
                  "key": "useOptimisticScenario",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "bigQueryLogType",
                  "value": "no"
                },
                {
                  "type": "template",
                  "key": "eventName",
                  "value": "standard"
                },
                {
                  "type": "list",
                  "key": "serverEventDataList",
                  "list": [
                    {
                      "type": "map",
                      "map": [
                        {
                          "type": "template",
                          "key": "name",
                          "value": "event_id"
                        },
                        {
                          "type": "template",
                          "key": "value",
                          "value": "{{ed - event_id}}"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "boolean",
                  "key": "enableMultipixelSetup",
                  "value": "false"
                },
                {
                  "type": "boolean",
                  "key": "enableEventEnhancement",
                  "value": "true"
                }
              ],
              "fingerprint": "1763844318388",
              "firingTriggerId": [
                "22"
              ],
              "tagFiringOption": "oncePerEvent",
              "monitoringMetadata": {
                "type": "map"
              },
              "consentSettings": {
                "consentStatus": "notSet"
              }
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "tagId": "37",
              "name": "GADS - Purchase Conversion",
              "type": "sgtmadsct",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "enableNewCustomerReporting",
                  "value": "false"
                },
                {
                  "type": "boolean",
                  "key": "enableConversionLinker",
                  "value": "true"
                },
                {
                  "type": "boolean",
                  "key": "enableProductReporting",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "conversionValue",
                  "value": "{{ed - value}}"
                },
                {
                  "type": "template",
                  "key": "conversionId",
                  "value": "{{GADS - Conversion ID}}"
                },
                {
                  "type": "template",
                  "key": "currencyCode",
                  "value": "{{ed - currency}}"
                },
                {
                  "type": "template",
                  "key": "conversionLabel",
                  "value": "{{GADS - Conversionlabel}}"
                },
                {
                  "type": "boolean",
                  "key": "rdp",
                  "value": "false"
                }
              ],
              "fingerprint": "1763844463843",
              "firingTriggerId": [
                "36"
              ],
              "tagFiringOption": "oncePerEvent",
              "monitoringMetadata": {
                "type": "map"
              },
              "consentSettings": {
                "consentStatus": "notSet"
              }
            }
          ],
          "trigger": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "9",
              "name": "Google Analytics Optout",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "matchRegex",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": ".*"
                    }
                  ]
                }
              ],
              "filter": [
                {
                  "type": "contains",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{Cookie - borlabs-cookie}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "google-analytics"
                    },
                    {
                      "type": "boolean",
                      "key": "negate",
                      "value": "true"
                    }
                  ]
                }
              ],
              "fingerprint": "1742309462366"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "10",
              "name": "web_vitals",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "web_vitals"
                    }
                  ]
                }
              ],
              "fingerprint": "1742309525489"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "12",
              "name": "scroll",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "scroll"
                    }
                  ]
                }
              ],
              "fingerprint": "1742310217743"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "14",
              "name": "click",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "click"
                    }
                  ]
                }
              ],
              "fingerprint": "1742310967284"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "16",
              "name": "video",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "video"
                    }
                  ]
                }
              ],
              "fingerprint": "1742312273327"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "22",
              "name": "GA4 - page_view",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "page_view"
                    }
                  ]
                }
              ],
              "filter": [
                {
                  "type": "contains",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{Client Name}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "GA4"
                    }
                  ]
                }
              ],
              "fingerprint": "1763844145369"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "24",
              "name": "All Events",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "matchRegex",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": ".*"
                    }
                  ]
                }
              ],
              "fingerprint": "1742394467819"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "36",
              "name": "GA4 - purchase",
              "type": "customEvent",
              "customEventFilter": [
                {
                  "type": "equals",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{_event}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "purchase"
                    }
                  ]
                }
              ],
              "filter": [
                {
                  "type": "contains",
                  "parameter": [
                    {
                      "type": "template",
                      "key": "arg0",
                      "value": "{{Client Name}}"
                    },
                    {
                      "type": "template",
                      "key": "arg1",
                      "value": "GA4"
                    }
                  ]
                }
              ],
              "fingerprint": "1763844447657"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "43",
              "name": "MCP Selftest Always 2026-02-11T10-06-51-418Z Updated",
              "type": "always",
              "fingerprint": "1770804470963",
              "parentFolderId": "41"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "49",
              "name": "MCP Selftest Always 2026-02-11T10-17-03-682Z Updated",
              "type": "always",
              "fingerprint": "1770805083646",
              "parentFolderId": "47"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "58",
              "name": "MCP Selftest Always 2026-02-11T11-04-59-014Z Updated",
              "type": "always",
              "fingerprint": "1770807959018",
              "parentFolderId": "56"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "triggerId": "64",
              "name": "MCP Selftest Always 2026-02-11T11-18-11-050Z Updated",
              "type": "always",
              "fingerprint": "1770808751087",
              "parentFolderId": "62"
            }
          ],
          "variable": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "6",
              "name": "GA4 - Property ID",
              "type": "c",
              "parameter": [
                {
                  "type": "template",
                  "key": "value",
                  "value": "G-NFPCRGZ1V2"
                }
              ],
              "fingerprint": "1742309013700",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "8",
              "name": "Cookie - borlabs-cookie",
              "type": "sgtmk",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "decodeCookie",
                  "value": "true"
                },
                {
                  "type": "template",
                  "key": "name",
                  "value": "borlabs-cookie"
                }
              ],
              "fingerprint": "1742309411022",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "28",
              "name": "FB - API Access Token",
              "type": "c",
              "parameter": [
                {
                  "type": "template",
                  "key": "value",
                  "value": "INPUTHERE"
                }
              ],
              "fingerprint": "1763844216393",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "29",
              "name": "FB - Pixel ID",
              "type": "c",
              "parameter": [
                {
                  "type": "template",
                  "key": "value",
                  "value": "INPUTHERE"
                }
              ],
              "fingerprint": "1763844236168",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "30",
              "name": "ed - event_id",
              "type": "ed",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "setDefaultValue",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "keyPath",
                  "value": "event_id"
                }
              ],
              "fingerprint": "1763844294640",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "32",
              "name": "GADS - Conversion ID",
              "type": "c",
              "parameter": [
                {
                  "type": "template",
                  "key": "value",
                  "value": "INPUTHERE"
                }
              ],
              "fingerprint": "1763844363943",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "33",
              "name": "GADS - Conversionlabel",
              "type": "c",
              "parameter": [
                {
                  "type": "template",
                  "key": "value",
                  "value": "INPUTHERE"
                }
              ],
              "fingerprint": "1763844388717",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "34",
              "name": "ed - value",
              "type": "ed",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "setDefaultValue",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "keyPath",
                  "value": "value"
                }
              ],
              "fingerprint": "1763844404383",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "35",
              "name": "ed - currency",
              "type": "ed",
              "parameter": [
                {
                  "type": "boolean",
                  "key": "setDefaultValue",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "keyPath",
                  "value": "currency"
                }
              ],
              "fingerprint": "1763844422377",
              "formatValue": {}
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "42",
              "name": "MCP Selftest Random Updated 2026-02-11T10-06-51-418Z",
              "type": "r",
              "fingerprint": "1770804470962",
              "parentFolderId": "41"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "48",
              "name": "MCP Selftest Random Updated 2026-02-11T10-17-03-682Z",
              "type": "r",
              "fingerprint": "1770805083645",
              "parentFolderId": "47"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "57",
              "name": "MCP Selftest Random Updated 2026-02-11T11-04-59-014Z",
              "type": "r",
              "fingerprint": "1770807959017",
              "parentFolderId": "56"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "variableId": "63",
              "name": "MCP Selftest Random Updated 2026-02-11T11-18-11-050Z",
              "type": "r",
              "fingerprint": "1770808751086",
              "parentFolderId": "62"
            }
          ],
          "folder": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "folderId": "41",
              "name": "MCP Selftest Renamed 2026-02-11T10-06-51-418Z",
              "fingerprint": "1770804423480"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "folderId": "47",
              "name": "MCP Selftest Renamed 2026-02-11T10-17-03-682Z",
              "fingerprint": "1770805035795"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "folderId": "56",
              "name": "MCP Selftest Renamed 2026-02-11T11-04-59-014Z",
              "fingerprint": "1770807911110"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "folderId": "62",
              "name": "MCP Selftest Renamed 2026-02-11T11-18-11-050Z",
              "fingerprint": "1770808703547"
            }
          ],
          "client": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "clientId": "23",
              "name": "GA4 Client",
              "type": "gaaw_client",
              "parameter": [
                {
                  "type": "template",
                  "key": "cookieDomain",
                  "value": "auto"
                },
                {
                  "type": "template",
                  "key": "cookieMaxAgeInSec",
                  "value": "63072000"
                },
                {
                  "type": "boolean",
                  "key": "activateGtagSupport",
                  "value": "false"
                },
                {
                  "type": "boolean",
                  "key": "activateDefaultPaths",
                  "value": "true"
                },
                {
                  "type": "template",
                  "key": "cookiePath",
                  "value": "/"
                },
                {
                  "type": "boolean",
                  "key": "migrateFromJsClientId",
                  "value": "false"
                },
                {
                  "type": "template",
                  "key": "cookieManagement",
                  "value": "server"
                },
                {
                  "type": "template",
                  "key": "cookieName",
                  "value": "FPID"
                }
              ],
              "fingerprint": "1742394013528"
            }
          ],
          "builtInVariable": [
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "type": "eventName",
              "name": "Event Name"
            },
            {
              "accountId": "572865630",
              "containerId": "208950707",
              "type": "clientName",
              "name": "Client Name"
            }
          ]
        }
      }
    },
    {
      "name": "gate_publish_version",
      "status": "pass",
      "details": {
        "error": "Confirmation required",
        "errorType": "CONFIRMATION_REQUIRED",
        "tool": "gtm_publish_version",
        "action": "publish_version",
        "note": "This makes the version live in the container.",
        "help": "Re-run the tool call with {\"confirm\": true} to proceed."
      }
    },
    {
      "name": "gtm_delete_version",
      "status": "skip",
      "details": {
        "code": 400,
        "message": "Returned an error response for your request.",
        "errorType": "UNKNOWN",
        "details": {
          "code": 400,
          "message": "Returned an error response for your request.",
          "errors": [
            {
              "message": "Returned an error response for your request.",
              "domain": "global",
              "reason": "badRequest"
            }
          ],
          "status": "INVALID_ARGUMENT"
        },
        "help": "An unexpected error occurred. Check the error details for more information.",
        "suggestions": [
          "Check the error details for specific information",
          "Try the operation with validated parameters",
          "Use helper tools like gtm_validate_trigger_config"
        ],
        "example": null
      }
    },
    {
      "name": "gtm_undelete_version",
      "status": "pass",
      "details": {
        "versionId": "17",
        "name": "MCP Selftest Version 2026-02-11T11-18-11-050Z",
        "path": "accounts/572865630/containers/208950707/versions/17",
        "description": "Created by MCP selftest"
      }
    },
    {
      "name": "gtm_enable_built_in_variables",
      "status": "pass",
      "details": []
    },
    {
      "name": "gtm_disable_built_in_variables",
      "status": "pass",
      "details": {
        "disabled": false,
        "types": [
          "EVENT"
        ]
      }
    },
    {
      "name": "gtm_revert_built_in_variable",
      "status": "pass",
      "details": {
        "reverted": false,
        "type": "EVENT"
      }
    },
    {
      "name": "gtm_list_user_permissions",
      "status": "pass",
      "details": [
        {
          "path": "accounts/572865630/user_permissions/12937491252075622238",
          "emailAddress": "tobias.batke@gmail.com",
          "accountId": "572865630"
        }
      ]
    },
    {
      "name": "gtm_create_user_permission",
      "status": "skip",
      "details": "Skipped: GTM_SELFTEST_RISKY=false"
    },
    {
      "name": "gtm_update_user_permission",
      "status": "skip",
      "details": "Skipped: GTM_SELFTEST_RISKY=false"
    },
    {
      "name": "gtm_delete_user_permission",
      "status": "skip",
      "details": "Skipped: GTM_SELFTEST_RISKY=false"
    }
  ],
  "cleanup": [
    {
      "name": "cleanup_workspace_submitted",
      "status": "skip",
      "details": "Skipped entity deletions after create_version because GTM marks workspace as submitted"
    },
    {
      "name": "cleanup_delete_environment",
      "status": "pass",
      "details": {
        "deleted": true,
        "path": "accounts/572865630/containers/208950707/environments/65"
      }
    },
    {
      "name": "cleanup_delete_template",
      "status": "fail",
      "details": {
        "code": 400,
        "message": "Workspace is already submitted.",
        "errorType": "UNKNOWN",
        "details": {
          "code": 400,
          "message": "Workspace is already submitted.",
          "errors": [
            {
              "message": "Workspace is already submitted.",
              "domain": "global",
              "reason": "badRequest"
            }
          ],
          "status": "INVALID_ARGUMENT"
        },
        "help": "An unexpected error occurred. Check the error details for more information.",
        "suggestions": [
          "Check the error details for specific information",
          "Try the operation with validated parameters",
          "Use helper tools like gtm_validate_trigger_config"
        ],
        "example": null
      }
    },
    {
      "name": "cleanup_delete_workspace",
      "status": "pass",
      "details": {
        "code": 500,
        "message": "Experienced an internal error.",
        "errorType": "UNKNOWN",
        "details": {
          "code": 500,
          "message": "Experienced an internal error.",
          "errors": [
            {
              "message": "Experienced an internal error.",
              "domain": "global",
              "reason": "backendError"
            }
          ],
          "status": "INTERNAL"
        },
        "help": "An unexpected error occurred. Check the error details for more information.",
        "suggestions": [
          "Check the error details for specific information",
          "Try the operation with validated parameters",
          "Use helper tools like gtm_validate_trigger_config"
        ],
        "example": null
      }
    }
  ],
  "serverStderr": [
    "    at async createAPIRequestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/googleapis-common/build/src/apirequest.js:308:25) {",
    "  config: {",
    "    url: URL {",
    "      href: 'https://tagmanager.googleapis.com/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19?type=EVENT',",
    "      origin: 'https://tagmanager.googleapis.com',",
    "      protocol: 'https:',",
    "      username: '',",
    "      password: '',",
    "      host: 'tagmanager.googleapis.com',",
    "      hostname: 'tagmanager.googleapis.com',",
    "      port: '',",
    "      pathname: '/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19',",
    "      search: '?type=EVENT',",
    "      searchParams: URLSearchParams { 'type' => 'EVENT' },",
    "      hash: ''",
    "    },",
    "    method: 'DELETE',",
    "    apiVersion: '',",
    "    userAgentDirectives: [ [Object] ],",
    "    paramsSerializer: [Function (anonymous)],",
    "    headers: Headers {",
    "      'accept-encoding': 'gzip',",
    "      authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',",
    "      'user-agent': 'google-api-nodejs-client/8.0.1 (gzip)',",
    "      'x-goog-api-client': 'gdcl/8.0.1 gl-node/25.2.1'",
    "    },",
    "    params: { type: [Array] },",
    "    validateStatus: [Function (anonymous)],",
    "    retry: true,",
    "    responseType: 'unknown',",
    "    errorRedactor: [Function: defaultErrorRedactor],",
    "    retryConfig: {",
    "      currentRetryAttempt: 3,",
    "      retry: 3,",
    "      httpMethodsToRetry: [Array],",
    "      noResponseRetries: 2,",
    "      retryDelayMultiplier: 2,",
    "      timeOfFirstRequest: 1770808924136,",
    "      totalTimeout: 9007199254740991,",
    "      maxRetryDelay: 9007199254740991,",
    "      statusCodesToRetry: [Array]",
    "    }",
    "  },",
    "  response: Response {",
    "    size: 0,",
    "    data: { error: [Object] },",
    "Error reverting built-in variable: GaxiosError: Workspace is already submitted.",
    "    at Gaxios._request (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/gaxios/build/cjs/src/gaxios.js:155:23)",
    "    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)",
    "    at async OAuth2Client.requestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)",
    "    at async createAPIRequestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/googleapis-common/build/src/apirequest.js:308:25) {",
    "  config: {",
    "    url: URL {",
    "      href: 'https://tagmanager.googleapis.com/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19/built_in_variables:revert?type=EVENT',",
    "      origin: 'https://tagmanager.googleapis.com',",
    "      protocol: 'https:',",
    "      username: '',",
    "      password: '',",
    "      host: 'tagmanager.googleapis.com',",
    "      hostname: 'tagmanager.googleapis.com',",
    "      port: '',",
    "      pathname: '/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19/built_in_variables:revert',",
    "      search: '?type=EVENT',",
    "      searchParams: URLSearchParams { 'type' => 'EVENT' },",
    "      hash: ''",
    "    },",
    "    method: 'POST',",
    "    apiVersion: '',",
    "    userAgentDirectives: [ [Object] ],",
    "    paramsSerializer: [Function (anonymous)],",
    "    headers: Headers {",
    "      'accept-encoding': 'gzip',",
    "      authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',",
    "      'user-agent': 'google-api-nodejs-client/8.0.1 (gzip)',",
    "      'x-goog-api-client': 'gdcl/8.0.1 gl-node/25.2.1'",
    "    },",
    "    params: { type: 'EVENT' },",
    "    validateStatus: [Function (anonymous)],",
    "    retry: true,",
    "    responseType: 'unknown',",
    "    errorRedactor: [Function: defaultErrorRedactor],",
    "    retryConfig: {",
    "      currentRetryAttempt: 0,",
    "      retry: 3,",
    "      httpMethodsToRetry: [Array],",
    "      noResponseRetries: 2,",
    "      retryDelayMultiplier: 2,",
    "      timeOfFirstRequest: 1770808928824,",
    "      totalTimeout: 9007199254740991,",
    "      maxRetryDelay: 9007199254740991,",
    "      statusCodesToRetry: [Array]",
    "    }",
    "  },",
    "  response: Response {",
    "    size: 0,",
    "    data: { error: [Object] },",
    "Error in deleteTemplate: GaxiosError: Workspace is already submitted.",
    "    at Gaxios._request (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/gaxios/build/cjs/src/gaxios.js:155:23)",
    "    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)",
    "    at async OAuth2Client.requestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)",
    "    at async createAPIRequestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/googleapis-common/build/src/apirequest.js:308:25) {",
    "  config: {",
    "    url: URL {",
    "      href: 'https://tagmanager.googleapis.com/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19/templates/66',",
    "      origin: 'https://tagmanager.googleapis.com',",
    "      protocol: 'https:',",
    "      username: '',",
    "      password: '',",
    "      host: 'tagmanager.googleapis.com',",
    "      hostname: 'tagmanager.googleapis.com',",
    "      port: '',",
    "      pathname: '/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19/templates/66',",
    "      search: '',",
    "      searchParams: URLSearchParams {},",
    "      hash: ''",
    "    },",
    "    method: 'DELETE',",
    "    apiVersion: '',",
    "    userAgentDirectives: [ [Object] ],",
    "    headers: Headers {",
    "      'accept-encoding': 'gzip',",
    "      authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',",
    "      'user-agent': 'google-api-nodejs-client/8.0.1 (gzip)',",
    "      'x-goog-api-client': 'gdcl/8.0.1 gl-node/25.2.1'",
    "    },",
    "    validateStatus: [Function (anonymous)],",
    "    retry: true,",
    "    responseType: 'unknown',",
    "    errorRedactor: [Function: defaultErrorRedactor],",
    "    retryConfig: {",
    "      currentRetryAttempt: 0,",
    "      retry: 3,",
    "      httpMethodsToRetry: [Array],",
    "      noResponseRetries: 2,",
    "      retryDelayMultiplier: 2,",
    "      timeOfFirstRequest: 1770808940935,",
    "      totalTimeout: 9007199254740991,",
    "      maxRetryDelay: 9007199254740991,",
    "      statusCodesToRetry: [Array]",
    "    }",
    "  },",
    "  response: Response {",
    "    size: 0,",
    "    data: { error: [Object] },",
    "    config: {",
    "      url: URL {},",
    "GTM API transient error, retrying in 1415ms (attempt 1/2)",
    "",
    "GTM API transient error, retrying in 2268ms (attempt 2/2)",
    "",
    "Error in deleteWorkspace: GaxiosError: Experienced an internal error.",
    "    at Gaxios._request (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/gaxios/build/cjs/src/gaxios.js:155:23)",
    "    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)",
    "    at async OAuth2Client.requestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/google-auth-library/build/src/auth/oauth2client.js:463:20)",
    "    at async createAPIRequestAsync (/Users/tobias_batke/Documents/Google Tag Manager Hilfe/gtm-mcp-server/node_modules/googleapis-common/build/src/apirequest.js:308:25) {",
    "  config: {",
    "    url: URL {",
    "      href: 'https://tagmanager.googleapis.com/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19',",
    "      origin: 'https://tagmanager.googleapis.com',",
    "      protocol: 'https:',",
    "      username: '',",
    "      password: '',",
    "      host: 'tagmanager.googleapis.com',",
    "      hostname: 'tagmanager.googleapis.com',",
    "      port: '',",
    "      pathname: '/tagmanager/v2/accounts/572865630/containers/208950707/workspaces/19',",
    "      search: '',",
    "      searchParams: URLSearchParams {},",
    "      hash: ''",
    "    },",
    "    method: 'DELETE',",
    "    apiVersion: '',",
    "    userAgentDirectives: [ [Object] ],",
    "    headers: Headers {",
    "      'accept-encoding': 'gzip',",
    "      authorization: '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.',",
    "      'user-agent': 'google-api-nodejs-client/8.0.1 (gzip)',",
    "      'x-goog-api-client': 'gdcl/8.0.1 gl-node/25.2.1'",
    "    },",
    "    validateStatus: [Function (anonymous)],",
    "    retry: true,",
    "    responseType: 'unknown',",
    "    errorRedactor: [Function: defaultErrorRedactor],",
    "    retryConfig: {",
    "      currentRetryAttempt: 3,",
    "      retry: 3,",
    "      httpMethodsToRetry: [Array],",
    "      noResponseRetries: 2,",
    "      retryDelayMultiplier: 2,",
    "      timeOfFirstRequest: 1770808956383,",
    "      totalTimeout: 9007199254740991,",
    "      maxRetryDelay: 9007199254740991,",
    "      statusCodesToRetry: [Array]",
    "    }",
    "  },",
    "  response: Response {",
    "    size: 0,",
    "    data: { error: [Object] },",
    "    config: {",
    "      url: URL {},"
  ]
}
